<xml>
 
    <src name="mvn_clean_install" type="bash" title="Maven clean install">
        <![CDATA[
mvn clean install
]]>
    </src>

	<src name="iolog" type="text" title="IOLOG">
        <![CDATA[
 [31/12 07:20:14]|IOLOG|INFO |http-nio-8080-exec-8|[POST] /ws/user
headers :
	accept: */*
	accept-encoding: gzip, deflate, br
	cache-control: no-cache
	connection: keep-alive
	content-length: 116
	content-type: application/json
	cookie: JSESSIONID=032FBAB561005F1AC0F658AFDE4EC26C
	host: localhost:8080
	postman-token: 5c5e83f4-4d72-442c-b5a2-8cc7c06be0e2
	user-agent: PostmanRuntime/7.29.2
payload :
[
    {
        "firstName":"John",
        "lastName":"Smith",
        "email":"john.smith.mock@inugami.io"
    }
]
[31/12 07:20:14]|IOLOG|INFO |http-nio-8080-exec-8|[POST] /ws/user
headers :
	accept: */*
	accept-encoding: gzip, deflate, br
	cache-control: no-cache
	connection: keep-alive
	content-length: 116
	content-type: application/json
	cookie: JSESSIONID=032FBAB561005F1AC0F658AFDE4EC26C
	host: localhost:8080
	postman-token: 5c5e83f4-4d72-442c-b5a2-8cc7c06be0e2
	user-agent: PostmanRuntime/7.29.2
payload :
[
    {
        "firstName":"John",
        "lastName":"Smith",
        "email":"john.smith.mock@inugami.io"
    }
]
response:
	status:200
	datetime:1767162014169
	duration:9
	contentType:application/json
	headers:
		Access-Control-Allow-Credentials: true
		Access-Control-Allow-Headers: 
		Access-Control-Allow-Methods: GET, POST, PUT, DELETE, PATCH, OPTIONS
		Access-Control-Allow-Origin: *
		Access-Control-Expose-Headers: 
		Content-Type: application/json
		accept: */*
		accept-encoding: gzip, deflate, br
		cache-control: no-cache
		connection: keep-alive
		content-length: 116
		content-type: application/json
		cookie: JSESSIONID=032FBAB561005F1AC0F658AFDE4EC26C
		host: localhost:8080
		postman-token: 5c5e83f4-4d72-442c-b5a2-8cc7c06be0e2
		user-agent: PostmanRuntime/7.29.2
		x-b3-traceid: 335f7176-8871-4f04-ad5e-d1c8c9b49f7b
		x-correlation-id: 3d69a6dc-9cc5-49fd-9812-03beb8dc34c3
		x-device-identifier: 2f411cae-e3b4-4465-b86a-e001c2b64d74
	payload:[{"audit":{"createdBy":"system","createdDate":"2025-12-31T06:20:14.164320179","version":1},"email":"john.smith.mock@inugami.io","firstName":"John","lastName":"Smith","uid":"31bd235a-8060-4f65-856b-33b7de38cc48"}]
]]>
    </src>

	<src name="error_response" type="json" title="Error response example">
        <![CDATA[
{
    "cause": {
        "errors": [],
        "message": "uid required to find user",
        "parameters": []
    },
    "detail": "",
    "details": {
        "errorCode": "USER-2_0",
        "fields": [],
        "version": "@project.version@",
        "errorType": "functional",
        "rollback": false,
        "retryable": false,
        "errorDomain": "USER",
        "service": "UserRestController_getById"
    },
    "errors": [],
    "message": "uid required to find user",
    "parameters": [],
    "reasonPhrase": "Bad Request",
    "status": 400
}
]]>
    </src>


 
    <src name="demo-api" type="java" title="Module demo-api">
        <![CDATA[
open module com.my.project.api {
    requires lombok;
    requires jdk.compiler;
    requires org.jspecify;
    requires io.inugami.framework.interfaces;

    exports com.my.project.api.domain.user;
    exports com.my.project.api.domain.user.dto;
    exports com.my.project.api.domain.user.exception;
}
]]>
    </src>

	 
    <src name="demo-api-userDto" type="java" title="UserDTO">
        <![CDATA[
@Getter
@Setter
@Builder(toBuilder = true)
@NoArgsConstructor
@AllArgsConstructor
@ToString(onlyExplicitlyIncluded = true)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class UserDTO implements Serializable {
    private static final long serialVersionUID = -8615427425887155741L;

    @ToString.Include
    private String uid;
    @ToString.Include
    private String firstName;
    @ToString.Include
    private String lastName;
    @ToString.Include
    @EqualsAndHashCode.Include
    private String email;

    private AuditDTO audit;
}
]]>
    </src>

		 
    <src name="demo-api-userDto-test" type="java" title="UserDTOTest">
        <![CDATA[
class UserDTOTest {

    @Test
    void userDTO() {
        assertDto(AssertDtoContext.<UserDTO>builder()
                                  .objectClass(UserDTO.class)
                                  .cloneFunction(i -> i.toBuilder().build())
                                  .noArgConstructor(UserDTO::new)
                                  .fullArgConstructor(this::buildUserDTO)
                                  .fullArgConstructorRefPath("api/domain/user/dto/userDTO/model.json")
                                  .getterRefPath("api/domain/user/dto/userDTO/getter.json")
                                  .toStringRefPath("api/domain/user/dto/userDTO/toString.txt")
                                  .noEqualsFunction(this::notEquals)
                                  .checkSetters(true)
                                  .build());
    }

    private void notEquals(final UserDTO instance) {
        assertThat(instance).isNotEqualTo(null);
        assertThat(instance).isNotEqualTo(instance.toBuilder());
        //
        assertThat(instance).isNotEqualTo(instance.toBuilder().email(null).build());
        assertThat(instance.toBuilder().email(null).build()).isNotEqualTo(instance);
        assertThat(instance).isNotEqualTo(instance.toBuilder().email(UnitTestData.OTHER).build());
        assertThat(instance.toBuilder().email(UnitTestData.OTHER).build()).isNotEqualTo(instance);
        assertThat(instance.hashCode()).isNotEqualTo(instance.toBuilder().email(null).build().hashCode());
        assertThat(instance.hashCode()).isNotEqualTo(instance.toBuilder()
                                                             .email(UnitTestData.OTHER)
                                                             .build()
                                                             .hashCode());
    }

    private UserDTO buildUserDTO() {
        return UserDTO.builder()
                      .uid(UnitTestData.UID)
                      .firstName(UnitTestData.FIRSTNAME)
                      .lastName(UnitTestData.LASTNAME)
                      .email(UnitTestData.EMAIL)
                      .build()
                      .toBuilder()
                      .build();
    }
}
]]>
    </src>

	 
    <src name="demo-api-userDto-userDTOSearchRequestDTO" type="java" title="UserDTOSearchRequestDTO">
        <![CDATA[
@ToString
@Setter
@Getter
@Builder(toBuilder = true)
@AllArgsConstructor
@NoArgsConstructor
public class UserDTOSearchRequestDTO implements SearchRequest , Serializable {
    private static final long         serialVersionUID = -6646958578723667636L;
    // SearchRequest
    private Integer                   page;
    private Integer                   pageSize;
    private String                    sortFields;
    private SortOrder                 sortOrder;
    @Singular("createdBy")
    private Collection<String>        createdBy;
    @Singular("createdDate")
    private Collection<LocalDateTime> createdDate;
    @Singular("lastModifiedBy")
    private Collection<String>        lastModifiedBy;
    @Singular("lastModifiedDate")
    private Collection<LocalDateTime> lastModifiedDate;

    // UserDTOSearchRequestDTO
    @Singular("uid")
    private Collection<String> uid;
    @Singular("firstName")
    private Collection<String> firstName;
    @Singular("lastName")
    private Collection<String> lastName;
    @Singular("email")
    private Collection<String> email;
}
]]>
    </src>

	 
    <src name="demo-api-userDto-userDTOSearchRequestDTO-test" type="java" title="UserDTOSearchRequestDTOTest">
        <![CDATA[
class UserDTOSearchRequestDTOTest {
    @Test
    void userDTOSearchRequestDTO() {
        assertDto(AssertDtoContext.<UserDTOSearchRequestDTO>builder()
                                  .objectClass(UserDTOSearchRequestDTO.class)
                                  .cloneFunction(i -> i.toBuilder().build())
                                  .noArgConstructor(UserDTOSearchRequestDTO::new)
                                  .fullArgConstructor(this::buildUserDTOSearchRequestDTO)
                                  .fullArgConstructorRefPath("api/domain/user/dto/userDTOSearchRequestDTO/model.json")
                                  .getterRefPath("api/domain/user/dto/userDTOSearchRequestDTO/getter.json")
                                  .toStringRefPath("api/domain/user/dto/userDTOSearchRequestDTO/toString.txt")
                                  .checkEquals(false)
                                  .checkSetters(true)
                                  .build());
    }


    private UserDTOSearchRequestDTO buildUserDTOSearchRequestDTO() {
        return UserDTOSearchRequestDTO.builder()
                                      .page(0)
                                      .pageSize(10)
                                      .sortFields("name")
                                      .sortOrder(SortOrder.ASC)
                                      .createdBy("system")
                                      .clearCreatedBy()
                                      .createdBy(List.of("system"))
                                      .createdDate(UnitTestData.DATE_TIME.minusDays(5))
                                      .clearCreatedDate()
                                      .createdDate(List.of(UnitTestData.DATE_TIME.minusDays(5)))
                                      .lastModifiedBy("system2")
                                      .clearLastModifiedBy()
                                      .lastModifiedBy(List.of("system2"))
                                      .lastModifiedDate(UnitTestData.DATE_TIME)
                                      .clearLastModifiedDate()
                                      .lastModifiedDate(List.of(UnitTestData.DATE_TIME))
                                      //------------------------------------------------------------------------------
                                      .uid(UnitTestData.UID)
                                      .clearUid()
                                      .uid(List.of(UnitTestData.UID))

                                      .firstName(UnitTestData.FIRSTNAME)
                                      .clearFirstName()
                                      .firstName(List.of(UnitTestData.FIRSTNAME))

                                      .lastName(UnitTestData.LASTNAME)
                                      .clearLastName()
                                      .lastName(List.of(UnitTestData.LASTNAME))

                                      .email(UnitTestData.EMAIL)
                                      .clearEmail()
                                      .email(List.of(UnitTestData.EMAIL))

                                      //------------------------------------------------------------------------------
                                      .build()
                                      .toBuilder()
                                      .build();
    }
]]>
    </src>


	<src name="demo-api-userFilters" type="java" title="UserFilters">
        <![CDATA[
@UtilityClass
public class UserFilters {

    public static final String UID        = "uid";
    public static final String FIRST_NAME = "firstName";
    public static final String LAST_NAME  = "lastName";
    public static final String EMAIL      = "email";


    public static final List<QueryFilterDTO<?>> FILTERS = buildFilters(
            QueryFilterDTO.<String>builder()
                          .field(UID)
                          .matchType(MatchType.IN)
                          .build(),
            QueryFilterDTO.<String>builder()
                          .field(FIRST_NAME)
                          .matchType(MatchType.CONTAINS)
                          .build(),
            QueryFilterDTO.<String>builder()
                          .field(LAST_NAME)
                          .matchType(MatchType.CONTAINS)
                          .build(),
            QueryFilterDTO.<String>builder()
                          .field(EMAIL)
                          .matchType(MatchType.IN)
                          .build()
                                                                      );
}
]]>
    </src>

		<src name="demo-api-userFilters" type="java" title="UserFilters">
        <![CDATA[
@UtilityClass
public class UserFilters {

    public static final String UID        = "uid";
    public static final String FIRST_NAME = "firstName";
    public static final String LAST_NAME  = "lastName";
    public static final String EMAIL      = "email";


    public static final List<QueryFilterDTO<?>> FILTERS = buildFilters(
            QueryFilterDTO.<String>builder()
                          .field(UID)
                          .matchType(MatchType.IN)
                          .build(),
            QueryFilterDTO.<String>builder()
                          .field(FIRST_NAME)
                          .matchType(MatchType.CONTAINS)
                          .build(),
            QueryFilterDTO.<String>builder()
                          .field(LAST_NAME)
                          .matchType(MatchType.CONTAINS)
                          .build(),
            QueryFilterDTO.<String>builder()
                          .field(EMAIL)
                          .matchType(MatchType.IN)
                          .build()
                                                                      );
}
]]>
    </src>

			<src name="demo-api-userFiltersTest" type="java" title="UserFiltersTest">
        <![CDATA[
class UserFiltersTest {
    @Test
    void assertUtilityClass() {
        UnitTestHelper.assertUtilityClassLombok(UserFilters.class);
    }


    @Test
    void assertFilters() {
        assertText(UserFilters.FILTERS,
                   """
                           [ {
                             "field" : "uid",
                             "matchType" : "IN"
                           }, {
                             "field" : "firstName",
                             "matchType" : "CONTAINS"
                           }, {
                             "field" : "lastName",
                             "matchType" : "CONTAINS"
                           }, {
                             "field" : "email",
                             "matchType" : "IN"
                           }, {
                             "field" : "createdBy",
                             "matchType" : "CONTAINS"
                           }, {
                             "field" : "createdDate",
                             "matchType" : "BETWEEN"
                           }, {
                             "field" : "lastModifiedBy",
                             "matchType" : "CONTAINS"
                           }, {
                             "field" : "lastModifiedDate",
                             "matchType" : "BETWEEN"
                           }, {
                             "field" : "version",
                             "matchType" : "BETWEEN"
                           } ]
                           """);
    }
}
]]>
    </src>


	<src name="demo-api-iUserService" type="java" title="IUserService">
        <![CDATA[
import io.inugami.framework.interfaces.models.crud.Crud;
//...

public interface IUserService extends Crud<UserDTO,String, UserDTOSearchRequestDTO> {
}
]]>
    </src>

		<src name="crud" type="java" title="Crud">
        <![CDATA[
package io.inugami.framework.interfaces.models.crud;

public interface Crud<T,PK,SR extends SearchRequest> {
    // =================================================================================================================
    // CREATE
    // =================================================================================================================
    Collection<T> create(final Collection<T> values);

    // =================================================================================================================
    // READ
    // =================================================================================================================
    SearchResponse<T> search(final SR searchRequest);

    T getById(final PK id, final Boolean full);

    boolean contains(final Collection<String> uids);

    Collection<T> getByIds(final Collection<PK> ids);

    // =================================================================================================================
    // UPDATE
    // =================================================================================================================
    Collection<T> update(final Collection<T> values, final boolean force);

    // =================================================================================================================
    // DELETE
    // =================================================================================================================
    void delete(final Collection<PK> ids);
}
]]>
    </src>

	<src name="demo-api-iUserDao" type="java" title="IUserDao">
        <![CDATA[
import io.inugami.framework.interfaces.models.crud.CrudDao;
//..

public interface IUserDao extends CrudDao<UserDTO,String, UserDTOSearchRequestDTO> {

}
]]>
    </src>

		
	<src name="crudDao" type="java" title="CrudDao">
        <![CDATA[
package io.inugami.framework.interfaces.models.crud;

//...

public interface CrudDao<T,PK,SR extends SearchRequest> {
    // =================================================================================================================
    // CREATE
    // =================================================================================================================
    Collection<T> create(final Collection<T> values);

    // =================================================================================================================
    // READ
    // =================================================================================================================
    SearchResponse<T> search(final SR searchRequest, final Collection<QueryFilterDTO<?>> requestFilters);

    T getById(final PK id, final Boolean full);

    boolean contains(final Collection<String> uids);

    Collection<T> getByIds(final Collection<PK> ids);

    // =================================================================================================================
    // UPDATE
    // =================================================================================================================
    Collection<T> update(final Collection<T> values);

    // =================================================================================================================
    // DELETE
    // =================================================================================================================
    void delete(final Collection<PK> ids);
}
]]>
    </src>


	<src name="UserErrors" type="java" title="UserErrors">
        <![CDATA[
public enum UserErrors implements ErrorCode {
    //==================================================================================================================
    // 0 - GENERIC
    //==================================================================================================================
    UNDEFINED(newBuilder().errorCode("USER-0_0")
                          .message("Undefined error occurs")
                          .domain(Constants.USER)
                          .statusCode(500)
                          .errorTypeTechnical()),

    //==================================================================================================================
    // 1 - CREATE
    //==================================================================================================================
    CREATE_INVALID_DATA(newBuilder().errorCode("USER-1_0")
                                    .message("invalid data for user creation")
                                    .domain(Constants.USER)
                                    .statusCode(400)
                                    .errorTypeFunctional()),

    CREATE_UID_FORBIDDEN(newBuilder().errorCode("USER-1_1")
                                     .message("uid is forbidden for user creation")
                                     .domain(Constants.USER)
                                     .statusCode(400)
                                     .errorTypeFunctional()),

    CREATE_FIRSTNAME_INVALID(newBuilder().errorCode("USER-1_2")
                                         .message("invalid firstname")
                                         .domain(Constants.USER)
                                         .statusCode(400)
                                         .errorTypeFunctional()),

    CREATE_LASTNAME_INVALID(newBuilder().errorCode("USER-1_3")
                                        .message("invalid lastname")
                                        .domain(Constants.USER)
                                        .statusCode(400)
                                        .errorTypeFunctional()),

    CREATE_EMAIL_INVALID(newBuilder().errorCode("USER-1_4")
                                     .message("invalid email")
                                     .domain(Constants.USER)
                                     .statusCode(400)
                                     .errorTypeFunctional()),

    //==================================================================================================================
    // 2 - READ
    //==================================================================================================================
    READ_USER_UID_REQUIRED(newBuilder().errorCode("USER-2_0")
                                       .message("uid required to find user")
                                       .domain(Constants.USER)
                                       .statusCode(400)
                                       .errorTypeFunctional()),
    READ_USER_NOT_FOUND(newBuilder().errorCode("USER-2_1")
                                    .message("user not found")
                                    .domain(Constants.USER)
                                    .statusCode(404)
                                    .errorTypeFunctional()),
    //==================================================================================================================
    // 3 - UPDATE
    //==================================================================================================================
    UPDATE_INVALID_DATA(newBuilder().errorCode("USER-3_0")
                                    .message("invalid data for user modification")
                                    .domain(Constants.USER)
                                    .statusCode(400)
                                    .errorTypeFunctional()),
    UPDATE_USERS_NOT_FOUND(newBuilder().errorCode("USER-3_1")
                                       .message("users not found")
                                       .domain(Constants.USER)
                                       .statusCode(404)
                                       .errorTypeFunctional()),

    UPDATE_UID_REQUIRED(newBuilder().errorCode("USER-3_2")
                                    .message("uid is required for user modification")
                                    .domain(Constants.USER)
                                    .statusCode(400)
                                    .errorTypeFunctional()),

    UPDATE_FIRSTNAME_INVALID(newBuilder().errorCode("USER-3_3")
                                         .message("invalid firstname")
                                         .domain(Constants.USER)
                                         .statusCode(400)
                                         .errorTypeFunctional()),

    UPDATE_LASTNAME_INVALID(newBuilder().errorCode("USER-3_4")
                                        .message("invalid lastname")
                                        .domain(Constants.USER)
                                        .statusCode(400)
                                        .errorTypeFunctional()),

    UPDATE_EMAIL_INVALID(newBuilder().errorCode("USER-3_5")
                                     .message("invalid email")
                                     .domain(Constants.USER)
                                     .statusCode(400)
                                     .errorTypeFunctional()),
    //==================================================================================================================
    // 4 - DELETE
    //==================================================================================================================
    DELETE_USER_UID_REQUIRED(newBuilder().errorCode("USER-4_0")
                                         .message("uid required to delete users")
                                         .domain(Constants.USER)
                                         .statusCode(400)
                                         .errorTypeFunctional()),
    DELETE_USERS_NOT_FOUND(newBuilder().errorCode("USER-4_1")
                                       .message("users not found")
                                       .domain(Constants.USER)
                                       .statusCode(404)
                                       .errorTypeFunctional())
    ;


    private final ErrorCode errorCode;

    private UserErrors(final DefaultErrorCode.DefaultErrorCodeBuilder errorBuilder) {
        errorCode = errorBuilder.build();
    }

    @Override
    public ErrorCode getCurrentErrorCode() {
        return errorCode;
    }

    private static class Constants {
        public static final String USER = "USER";
    }
}
]]>
    </src>

	<src name="userErrors" type="java" title="UserErrors">
        <![CDATA[
public enum UserErrors implements ErrorCode {
    //==================================================================================================================
    // 0 - GENERIC
    //==================================================================================================================
    UNDEFINED(newBuilder().errorCode("USER-0_0")
                          .message("Undefined error occurs")
                          .domain(Constants.USER)
                          .statusCode(500)
                          .errorTypeTechnical()),

    //==================================================================================================================
    // 1 - CREATE
    //==================================================================================================================
    CREATE_INVALID_DATA(newBuilder().errorCode("USER-1_0")
                                    .message("invalid data for user creation")
                                    .domain(Constants.USER)
                                    .statusCode(400)
                                    .errorTypeFunctional()),

    CREATE_UID_FORBIDDEN(newBuilder().errorCode("USER-1_1")
                                     .message("uid is forbidden for user creation")
                                     .domain(Constants.USER)
                                     .statusCode(400)
                                     .errorTypeFunctional()),

    CREATE_FIRSTNAME_INVALID(newBuilder().errorCode("USER-1_2")
                                         .message("invalid firstname")
                                         .domain(Constants.USER)
                                         .statusCode(400)
                                         .errorTypeFunctional()),

    CREATE_LASTNAME_INVALID(newBuilder().errorCode("USER-1_3")
                                        .message("invalid lastname")
                                        .domain(Constants.USER)
                                        .statusCode(400)
                                        .errorTypeFunctional()),

    CREATE_EMAIL_INVALID(newBuilder().errorCode("USER-1_4")
                                     .message("invalid email")
                                     .domain(Constants.USER)
                                     .statusCode(400)
                                     .errorTypeFunctional()),

    //==================================================================================================================
    // 2 - READ
    //==================================================================================================================
    READ_USER_UID_REQUIRED(newBuilder().errorCode("USER-2_0")
                                       .message("uid required to find user")
                                       .domain(Constants.USER)
                                       .statusCode(400)
                                       .errorTypeFunctional()),
    READ_USER_NOT_FOUND(newBuilder().errorCode("USER-2_1")
                                    .message("user not found")
                                    .domain(Constants.USER)
                                    .statusCode(404)
                                    .errorTypeFunctional()),
    //==================================================================================================================
    // 3 - UPDATE
    //==================================================================================================================
    UPDATE_INVALID_DATA(newBuilder().errorCode("USER-3_0")
                                    .message("invalid data for user modification")
                                    .domain(Constants.USER)
                                    .statusCode(400)
                                    .errorTypeFunctional()),
    UPDATE_USERS_NOT_FOUND(newBuilder().errorCode("USER-3_1")
                                       .message("users not found")
                                       .domain(Constants.USER)
                                       .statusCode(404)
                                       .errorTypeFunctional()),

    UPDATE_UID_REQUIRED(newBuilder().errorCode("USER-3_2")
                                    .message("uid is required for user modification")
                                    .domain(Constants.USER)
                                    .statusCode(400)
                                    .errorTypeFunctional()),

    UPDATE_FIRSTNAME_INVALID(newBuilder().errorCode("USER-3_3")
                                         .message("invalid firstname")
                                         .domain(Constants.USER)
                                         .statusCode(400)
                                         .errorTypeFunctional()),

    UPDATE_LASTNAME_INVALID(newBuilder().errorCode("USER-3_4")
                                        .message("invalid lastname")
                                        .domain(Constants.USER)
                                        .statusCode(400)
                                        .errorTypeFunctional()),

    UPDATE_EMAIL_INVALID(newBuilder().errorCode("USER-3_5")
                                     .message("invalid email")
                                     .domain(Constants.USER)
                                     .statusCode(400)
                                     .errorTypeFunctional()),
    //==================================================================================================================
    // 4 - DELETE
    //==================================================================================================================
    DELETE_USER_UID_REQUIRED(newBuilder().errorCode("USER-4_0")
                                         .message("uid required to delete users")
                                         .domain(Constants.USER)
                                         .statusCode(400)
                                         .errorTypeFunctional()),
    DELETE_USERS_NOT_FOUND(newBuilder().errorCode("USER-4_1")
                                       .message("users not found")
                                       .domain(Constants.USER)
                                       .statusCode(404)
                                       .errorTypeFunctional())
    ;


    private final ErrorCode errorCode;

    private UserErrors(final DefaultErrorCode.DefaultErrorCodeBuilder errorBuilder) {
        errorCode = errorBuilder.build();
    }

    @Override
    public ErrorCode getCurrentErrorCode() {
        return errorCode;
    }

    private static class Constants {
        public static final String USER = "USER";
    }
}
]]>
    </src>


	<src name="errorCode" type="java" title="Inugami interface ErrorCode">
        <![CDATA[
public interface ErrorCode {
    public ErrorCode                                 getCurrentErrorCode();
    default int                                      getStatusCode() { }
    default String                                   getErrorCode() { }
    default String                                   getMessage() { }
    default String                                   getMessageDetail() { }
    default boolean                                  isExploitationError() { }
    default String                                   getErrorType() { }
    default String                                   getDomain() { }
    default String                                   getSubDomain() { }
    default String                                   getPayload() { }
    default String                                   getUrl() { }
    default boolean                                  isRollbackRequire() { }
    default boolean                                  isRetryable() { }
    default BiConsumer<String, Exception>            getErrorHandler() { }
    default ErrorCode                                addDetail(final String detail, final Object... values) { }
    default String                                   getCategory() { }
    default String                                   getField() { }
    default DefaultErrorCode.DefaultErrorCodeBuilder toBuilder() { }
    default Map<String, Serializable>                toMap() { }
    default List<String>                             keysSet() { }
}
]]>
    </src>

	<src name="userErrorsTest" type="java" title="UserErrorsTest">
        <![CDATA[
class UserErrorsTest {
    @Test
    void assertUserErrors() {
        UnitTestHelper.assertErrorCodeUnique(UserErrors.values());
        UnitTestHelper.assertErrorCode("api/domain/user/exception/assertUserErrors.json",
                                       UserErrors.values());
    }
}
]]>
    </src>

	<src name="core_module" type="java" title="Core module">
        <![CDATA[
open module com.my.project.core {
    requires com.fasterxml.jackson.annotation;
    requires io.inugami.framework.commons.spring;
    requires io.inugami.framework.commons;
    requires io.inugami.framework.configurations.configuration;
    requires io.inugami.framework.api;
    requires io.inugami.framework.interfaces;
    requires jakarta.annotation;
    requires jdk.compiler;
    requires lombok;
    requires org.jspecify;
    requires org.slf4j;
    requires spring.beans;
    requires spring.boot;
    requires spring.context;
    requires spring.tx;
    //
    requires com.my.project.api;
    //
    exports com.my.project.core.domain.user;
}
]]>
    </src>


		<src name="userService" type="java" title="UserService">
        <![CDATA[
import com.my.project.api.domain.user.*;
import com.my.project.api.domain.user.dto.*;
import io.inugami.framework.interfaces.models.search.SearchResponse;
import io.inugami.framework.interfaces.tools.ListUtils;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import static com.my.project.api.domain.user.exception.UserErrors.*;
import static io.inugami.framework.interfaces.exceptions.Asserts.*;
import static io.inugami.framework.interfaces.exceptions.DefaultErrorCode.fromErrorCode;
import static io.inugami.framework.interfaces.functionnals.FunctionalUtils.applyIfNotNull;

@RequiredArgsConstructor
@Service
public class UserService implements IUserService {
    //==================================================================================================================
    // ATTRIBUTES
    //==================================================================================================================
	//...

    private final IUserDao userDao;

    //==================================================================================================================
    // CREATE
    //==================================================================================================================
    @Transactional
    @Override
    public Collection<UserDTO> create(final Collection<UserDTO> values) {
        //
    }

    //==================================================================================================================
    // READ
    //==================================================================================================================
    @Override
    public SearchResponse<UserDTO> search(final UserDTOSearchRequestDTO searchRequest) {
        //
    }

    @Override
    public UserDTO getById(final String id, final Boolean full) {
       //
    }

    @Override
    public boolean contains(final Collection<String> uids) {
       //
    }

    @Override
    public Collection<UserDTO> getByIds(final Collection<String> uids) {
        //
    }

    //==================================================================================================================
    // UPDATE
    //==================================================================================================================
    @Transactional
    @Override
    public Collection<UserDTO> update(final Collection<UserDTO> values, final boolean force) {
        //
    }

 

    //==================================================================================================================
    // DELETE
    //==================================================================================================================
    @Transactional
    @Override
    public void delete(final Collection<String> ids) {
       //
    }
}
]]>
    </src>


<src name="userService_create" type="java" title="UserService creation method">
        <![CDATA[
//...
protected static final String FIELD_UID       = "{0}.uid";
protected static final String FIELD_FIRSTNAME = "{0}.firstName";
protected static final String FIELD_LASTNAME  = "{0}.lastName";
protected static final String FIELD_EMAIL     = "{0}.email";
protected static final int    MAX_SIZE        = 256;

//==================================================================================================================
// CREATE
//==================================================================================================================
@Transactional
@Override
public Collection<UserDTO> create(final Collection<UserDTO> values) {
	assertNotEmpty(CREATE_INVALID_DATA, values);

	assertModel(values,
		(v, index) -> assertNull(fromErrorCode(CREATE_UID_FORBIDDEN)
						.addField(FIELD_UID, index)
						.build(), v.getUid()),

		(v, index) -> {
			assertNotEmpty(fromErrorCode(CREATE_FIRSTNAME_INVALID)
						.addField(FIELD_FIRSTNAME, index)
						.build(), v.getFirstName());

			v.setFirstName(v.getFirstName().trim());
			assertLowerOrEquals(fromErrorCode(CREATE_FIRSTNAME_INVALID)
						.addField(FIELD_FIRSTNAME, index)
						.build(), MAX_SIZE, v.getFirstName().length());
		},

		(v, index) -> {
			assertNotEmpty(fromErrorCode(CREATE_LASTNAME_INVALID)
						.addField(FIELD_LASTNAME, index)
						.build(), v.getLastName());
			v.setLastName(v.getLastName().trim());
			assertLowerOrEquals(fromErrorCode(CREATE_LASTNAME_INVALID)
						.addField(FIELD_LASTNAME, index)
						.build(), MAX_SIZE, v.getLastName().length());
		},

		(v, index) -> {
			assertNotEmpty(fromErrorCode(CREATE_EMAIL_INVALID)
						.addField(FIELD_EMAIL, index)
						.build(), v.getEmail());
			v.setEmail(v.getEmail().trim());
			assertRegexMatch(fromErrorCode(CREATE_EMAIL_INVALID)
						.addField(FIELD_EMAIL, index)
						.build(), EMAIL_REGEX, v.getEmail());
		});

	return userDao.create(values);
}
]]>
    </src>

	<src name="userService_create_error_test" type="java" title="Verify error code">
        <![CDATA[
@Test
void create_withEmptyData() {
	assertThrows(CREATE_INVALID_DATA, () -> userService.create(null));
	assertThrows(CREATE_INVALID_DATA, () -> userService.create(List.of()));
}
]]>
	</src>

	<src name="userService_getById" type="java" title="UserService getById">
        <![CDATA[
    @Override
    public UserDTO getById(final String id, final Boolean full) {
        assertRegexMatch(READ_USER_UID_REQUIRED, UID_REGEX, id);

        final var result = userDao.getById(id, full);

        assertNotNull(READ_USER_NOT_FOUND, result);
        return result;
    }
]]>
    </src>

		<src name="UID_REGEX" type="text" title="Standard UUID regex">
        <![CDATA[
([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})
]]>
  </src>

		<src name="EMAIL_REGEX" type="text" title="Standard HTML5 email regex">
        <![CDATA[
^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$
]]>
    </src>




		<src name="userServiceTest" type="java" title="UserServiceTest">
        <![CDATA[
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    //==================================================================================================================
    // ATTRIBUTES
    //==================================================================================================================
    @Mock
    private IUserDao    userDao;
    @InjectMocks
    private UserService userService;

	//==================================================================================================================
    // READ
    //==================================================================================================================
	@Test
    void getById_nominal() {
        when(userDao.getById(UnitTestData.UID, true)).thenReturn(buildUserDTO());
        assertText(userService.getById(UnitTestData.UID, true),
                   """
                           {
                             "audit" : {
                               "createdBy" : "system",
                               "createdDate" : "2023-05-27T12:00:00",
                               "lastModifiedBy" : "user-1",
                               "lastModifiedDate" : "2023-06-01T12:00:00",
                               "version" : 1
                             },
                             "email" : "john.smith@mock.org",
                             "firstName" : "John",
                             "lastName" : "Smith",
                             "uid" : "bb895294-efe7-484b-b670-14d004eaf461"
                           }
                           """);
    }

    @Test
    void getById_withErrors() {
        assertThrows(READ_USER_UID_REQUIRED, () -> userService.getById(UnitTestData.OTHER, true));
        assertThrows(READ_USER_NOT_FOUND, () -> userService.getById(UnitTestData.UID, true));
    }

    //==================================================================================================================
    // TOOLS
    //==================================================================================================================
    private UserDTO buildUserDTO() {
        return UserDTO.builder()
                      .uid(UnitTestData.UID)
                      .firstName(UnitTestData.FIRSTNAME)
                      .lastName(UnitTestData.LASTNAME)
                      .email(UnitTestData.EMAIL)
                      .audit(AuditDTO.builder()
                                     .createdBy("system")
                                     .createdDate(UnitTestData.DATE_TIME.minusDays(5))
                                     .lastModifiedBy("user-1")
                                     .lastModifiedDate(UnitTestData.DATE_TIME)
                                     .version(1L)
                                     .build())
                      .build();
    }
}
]]>
    </src>

	<src name="UnitTestData" type="java" title="UnitTestData">
        <![CDATA[
@UtilityClass
public class UnitTestData {

    // =========================================================================
    // DATA
    // =========================================================================
    public static final long          ID                = 1L;
    public static final long          ID_OTHER          = 2L;
    public static final String        OTHER             = "XXX";
    public static final String[]      LOREM             = DataGeneratorUtils.LOREM;
    public static final String[]      CATEGORY          = DataGeneratorUtils.CATEGORY;
    public static final LocalDate     TODAY             = LocalDate.now();
    public static final LocalDateTime NOW_UTC           = LocalDateTime.now(ZoneOffset.UTC);
    public static final LocalDateTime DATE_TIME         = LocalDateTime.of(2023, 6, 1, 12, 0, 0);
    public static final String        UID               = "bb895294-efe7-484b-b670-14d004eaf461";
    public static final String        UID_CONTRACTED    = "bb895294efe7484bb67014d004eaf461";
    public static final String        DEVICE_IDENTIFIER = "4547abf0-4bd2-4ff7-ac6c-4eb27cd83c10";
    public static final String        CORRELATION_ID    = "57f5a259-87e0-41c9-b56e-0332dcd81887";
    public static final String        CONVERSATION_ID   = "90b79730-7276-402b-9fe2-be1543f484e4";
    public static final String        TRACE_ID          = "edff7c9651a5";
    public static final String        EMAIL             = "john.smith@mock.org";
    public static final String        FIRSTNAME         = "John";
    public static final String        LASTNAME          = "Smith";
    public static final String        LASTNAME2         = "Lalonde";
    public static final String        LOREM_IPSUM       = "Lorem ipsum dolor sit amet, consectetur adipiscing elit";
    public static final String        LOREM_IPSUM_2     = "Suspendisse in quam in felis mollis ullamcorper ac in lectus";
    public static final String        LOREM_IPSUM_3     = "Nulla non leo vitae nunc aliquam mollis";
    public static final String        LOREM_IPSUM_4     = "Duis fringilla facilisis dui sed luctus.";
    public static final String        NAVS13_1          = "7564971247732";
    public static final String        NAVS13_2          = "7560769504407";
    public static final String        NAVS13_3          = "7566987985080";
    public static final String        PHONE_NUMBER_1    = "0615031522";
    public static final String        PHONE_NUMBER_2    = "0225993475";
    public static final String        PHONE_NUMBER_3    = "0624455065";

    public static final String      STREET_NAME   = "du Château";
    public static final String      STREET_TYPE   = "Chem.";
    public static final String      CITY          = "Cheseaux-sur-Lausanne";
    public static final String      ZIP_CODE      = "1033";
    public static final String      STREET_NUMBER = "10";
    public static final String      CANTON        = "VD";
    public static final String      NATIONALITY   = "CH";
    // =========================================================================
    // USERS
    // =========================================================================
    public static final UserDataDTO USER_1        = UserDataDTO.builder()
                                                               .id(1L)
                                                               .sex(UserDataDTO.Sex.FEMALE)
                                                               .firstName("Émilie")
                                                               .lastName(LASTNAME2)
                                                               .email("emilie.lalonde@mock.org")
                                                               .phoneNumber(PHONE_NUMBER_1)
                                                               .old(35)
                                                               .birthday(LocalDate.of(1988, 4, 12))
                                                               .socialId(NAVS13_1)
                                                               .nationality(NATIONALITY)
                                                               .canton(CANTON)
                                                               .streetName(STREET_NAME)
                                                               .streetNumber(STREET_NUMBER)
                                                               .streetType(STREET_TYPE)
                                                               .zipCode(ZIP_CODE)
                                                               .city(CITY)
                                                               .deviceIdentifier("401f0498-c43f-43ad-a3f4-2888838332ad")
                                                               .build();


    public static final UserDataDTO USER_2 = UserDataDTO.builder()
                                                        .id(2L)
                                                        .sex(UserDataDTO.Sex.FEMALE)
                                                        .firstName("Jessamine")
                                                        .lastName(LASTNAME2)
                                                        .email("jessamine.lalonde@mock.org")
                                                        .phoneNumber(PHONE_NUMBER_2)
                                                        .old(10)
                                                        .birthday(LocalDate.of(2013, 6, 21))
                                                        .socialId(NAVS13_2)
                                                        .nationality(NATIONALITY)
                                                        .canton(CANTON)
                                                        .streetName(STREET_NAME)
                                                        .streetNumber(STREET_NUMBER)
                                                        .streetType(STREET_TYPE)
                                                        .zipCode(ZIP_CODE)
                                                        .city(CITY)
                                                        .deviceIdentifier("46bfaa1a-0adf-4660-994a-e56f4b059c8f")
                                                        .build();


    public static final UserDataDTO USER_3 = UserDataDTO.builder()
                                                        .id(3L)
                                                        .sex(UserDataDTO.Sex.MALE)
                                                        .firstName("Théodore")
                                                        .lastName(LASTNAME2)
                                                        .email("theodore.lalonde@mock.org")
                                                        .phoneNumber(PHONE_NUMBER_3)
                                                        .old(38)
                                                        .birthday(LocalDate.of(1985, 7, 10))
                                                        .socialId(NAVS13_3)
                                                        .nationality(NATIONALITY)
                                                        .canton(CANTON)
                                                        .streetName(STREET_NAME)
                                                        .streetNumber(STREET_NUMBER)
                                                        .streetType(STREET_TYPE)
                                                        .zipCode(ZIP_CODE)
                                                        .city(CITY)
                                                        .deviceIdentifier("45fa3dd1-714e-4887-b27d-9792b327ad56")
                                                        .build();

    // =========================================================================
    // RANDOM
    // =========================================================================
    static String getRandomUid() {  }

    static String getRandomWord() { }

    static String getRandomCategory() { }

    static String getRandomLabel() { }

    static String getRandomPhrase() { }

    static String getRandomPhrase(final int nbWordMin, final int nbWordMax, final boolean isLabel) { }

    static String getRandomSection() { }

    static String getRandomSection(final int nbLine, final int nbWordMin, final int nbWordMax) { }

    static double getRandomDouble(final double min, final double max) { }

    static int getRandomBetween(final int start, final int end) { }
}

]]>
    </src>



	<src name="UserDao" type="java" title="UserDao">
        <![CDATA[
@RequiredArgsConstructor
@Builder
@Service
public class UserDao implements IUserDao {
    //==================================================================================================================
    // ATTRIBUTES
    //==================================================================================================================
    private final UserEntityRepository userEntityRepository;
    private final UserEntityMapper     userEntityMapper;

    //==================================================================================================================
    // CREATE
    //==================================================================================================================
    @Transactional
    @Override
    public Collection<UserDTO> create(final Collection<UserDTO> values) {
        final var result = userEntityRepository.saveAll(userEntityMapper.convertToEntity(values));
        return userEntityMapper.convertToDto(result);
    }

    //==================================================================================================================
    // READ
    //==================================================================================================================
   	//...

    @Override
    public UserDTO getById(final String uid, final Boolean full) {
        return Optional.ofNullable(full).orElse(false).booleanValue()
               ? userEntityRepository.findById(uid).map(userEntityMapper::convertToDto).orElse(null)
               : userEntityRepository.findByUidProjected(uid)
                                     .map(userEntityMapper::convertProjectionToDto)
                                     .orElse(null);
    }
	
	//...
}
]]>
    </src>

		<src name="UserEntityMapper" type="java" title="UserEntityMapper">
        <![CDATA[
@Mapper
public interface UserEntityMapper {

    UserEntity convertToEntity(final UserDTO value);

    default Collection<UserEntity> convertToEntity(final Collection<UserDTO> values) {
        return Optional.ofNullable(values)
                       .orElse(List.of())
                       .stream().map(this::convertToEntity)
                       .toList();
    }

    @Mapping(target = "audit", expression = "java(AuditEntityMapperUtils.convertToAuditDTO(value))")
    UserDTO convertProjectionToDto(final UserProjection value);

    @Mapping(target = "audit", expression = "java(AuditEntityMapperUtils.convertToAuditDTO(value))")
    UserDTO convertToDto(final UserEntity value);

    default Collection<UserDTO> convertToDto(final Collection<UserEntity> values) {
        return Optional.ofNullable(values)
                       .orElse(List.of())
                       .stream().map(this::convertToDto)
                       .toList();
    }
}
]]>
    </src>

			<src name="DatasourceEntityMapperConfiguration" type="java" title="DatasourceEntityMapperConfiguration">
        <![CDATA[
@Configuration
public class DatasourceEntityMapperConfiguration {

    @Bean
    public UserEntityMapper userEntityMapper(){
        return Mappers.getMapper(UserEntityMapper.class);
    }
}
]]>
</src>

<src name="pom_integration_test" type="xml" title="Configure integration-test in your project">
        <![CDATA[
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<!--================================================================================================================
	= PARENT
	=================================================================================================================-->
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.5.8</version>
	</parent>
	
	<!--================================================================================================================
	= PROJECT
	=================================================================================================================-->
	<groupId>com.my.project</groupId>
	<artifactId>demo</artifactId>
	<packaging>pom</packaging>
	<version>1.0-SNAPSHOT</version>
	
	<!--================================================================================================================
	= BUILD
	=================================================================================================================-->
	<build>
		<resources>
			<resource>
			<directory>src/main/resources</directory>
			<filtering>false</filtering>
			<includes>
				<include>**/*.*</include>
			</includes>
			</resource>
			<resource>
			<directory>src/main/resources-filtered</directory>
			<filtering>true</filtering>
			<includes>
				<include>**/*.*</include>
			</includes>
			</resource>
		</resources>
		<testResources>
			<testResource>
			<directory>src/test/resources</directory>
			<filtering>false</filtering>
			</testResource>
			<testResource>
			<directory>src/test_it/resources</directory>
			<filtering>true</filtering>
			</testResource>
		</testResources>

		<plugins>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>build-helper-maven-plugin</artifactId>
				<version>${org.codehaus.mojo.version}</version>
				<executions>
					<execution>
					<id>add-integration-test-source</id>
					<phase>generate-test-sources</phase>
					<goals>
						<goal>add-test-source</goal>
					</goals>
					<configuration>
						<sources>
						<source>src/test_it/java</source>
						</sources>
					</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-surefire-plugin</artifactId>
				<configuration>
					<argLine>-Xmx1024M -Dfile.encoding=${encoding} ${maven.plugins.surfire.argLine}</argLine>
					<systemPropertyVariables>
					<mock.generator.path>${mock.generator.path}</mock.generator.path>
					</systemPropertyVariables>
					<includes>
					<include>**/*Test.java</include>
					</includes>
					<excludes>
					<exclude>**/*IT.java</exclude>
					</excludes>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-failsafe-plugin</artifactId>
				<executions>
					<execution>
					<phase>integration-test</phase>
					<goals>
						<goal>integration-test</goal>
					</goals>
					</execution>
					<execution>
					<id>verify</id>
					<goals>
						<goal>verify</goal>
					</goals>
					</execution>
				</executions>
				<configuration>
					<argLine>-Dfile.encoding=${encoding} ${failsafe-custom-args} ${maven.plugins.failsafe.argLine}
							</argLine>
					<includes>
					<include>**/*IT.java</include>
					</includes>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.jacoco</groupId>
				<artifactId>jacoco-maven-plugin</artifactId>
				<version>${jacoco.version}</version>
				<configuration>
					<formats>
					<format>XML</format>
					<format>HTML</format>
					</formats>
					<excludes>
					<exclude>**/*DTOBuilder*</exclude>
					<exclude>**/*Entity</exclude>
					<exclude>**/*EntityBuilder*</exclude>
					<exclude>**/*Properties</exclude>
					<exclude>**org/jboss/resteasy/logging/*</exclude>
					<exclude>**/engine/js/*</exclude>
					<exclude>**/FeatureInterceptor</exclude>
					</excludes>
				</configuration>
				<executions>
					<execution>
					<id>prepare-agent</id>
					<goals>
						<goal>prepare-agent</goal>
					</goals>
					<phase>compile</phase>
					<configuration>
						<append>true</append>
						<propertyName>maven.plugins.surfire.argLine</propertyName>
					</configuration>
					</execution>
					<execution>
					<id>prepare-agent-integration-test</id>
					<goals>
						<goal>prepare-agent-integration</goal>
					</goals>
					<phase>compile</phase>
					<configuration>
						<append>true</append>
						<propertyName>maven.plugins.failsafe.argLine</propertyName>
					</configuration>
					</execution>
					<execution>
					<id>report</id>
					<goals>
						<goal>report</goal>
					</goals>
					<phase>package</phase>
					</execution>
					<execution>
					<id>report-integration</id>
					<goals>
						<goal>report-integration</goal>
					</goals>
					<phase>post-integration-test</phase>
					</execution>
				</executions>
				</plugin>
		</plugins>
	</build>
</project>
]]>
    </src>


			<src name="SpringBootIntegrationRunner" type="java" title="SpringBootIntegrationRunner">
        <![CDATA[
@ActiveProfiles("test")
@SpringBootTest(classes={SpringBootITConfiguration.class})
public class SpringBootIntegrationRunner {

}
]]>
</src>
			<src name="SpringBootITConfiguration" type="java" title="SpringBootITConfiguration">
        <![CDATA[
@ComponentScan({
        Inugami.BASE_PACKAGE,
        "com.my.project.infrastructure"
})
@EnableAutoConfiguration
@SpringBootApplication
public class SpringBootITConfiguration {

}

]]>
</src>
			<src name="infra-application-test" type="yaml" title="application-test.yaml">
        <![CDATA[
spring:
  datasource:
    url: jdbc:h2:mem:inugami_db;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password:

jpa:
  database-platform: org.hibernate.dialect.H2Dialect
  hibernate:
    ddl-auto: update
  show-sql: true
  properties:
    hibernate:
      format_sql: true
]]>
</src>

			<src name="UserDaoIT" type="java" title="UserDaoIT">
        <![CDATA[
class UserDaoIT extends SpringBootIntegrationRunner {
    //==================================================================================================================
    // ATTRIBUTES
    //==================================================================================================================
    @Autowired
    private UserDao userDao;

    //==================================================================================================================
    // CRUD
    //==================================================================================================================
    @Test
    void crud_nominal() {
        //--------------------------------------------------------------------------------------------------------------
        // CREATE
        //--------------------------------------------------------------------------------------------------------------
        final var user = userDao.create(List.of(buildUserDTO())).stream().findFirst().orElse(null);
        assertText(user,
                   """
                           {
                             "audit" : {
                               "createdBy" : "system",
                               "createdDate" : "2025-12-28T14:55:06.818512023",
                               "version" : 1
                             },
                             "email" : "john.smith@mock.org",
                             "firstName" : "John",
                             "lastName" : "Smith",
                             "uid" : "8cb82298-0dd4-46ab-a427-587147ebd09a"
                           }
                           """,
                   LocalDateTimeLineMatcher.of(3),
                   UuidLineMatcher.of(9));

        //--------------------------------------------------------------------------------------------------------------
        // READ
        //--------------------------------------------------------------------------------------------------------------
        assertTextIntegration(userDao.getById(user.getUid(), false),
                              "infrastructure/database/dao/userDaoIT/getById.nominal.json",
                              LocalDateTimeLineMatcher.of(3),
                              UuidLineMatcher.of(9));

		// ...
    }

    //==================================================================================================================
    // TOOLS
    //==================================================================================================================
    private UserDTO buildUserDTO() {
        return UserDTO.builder()
                      .firstName(UnitTestData.FIRSTNAME)
                      .lastName(UnitTestData.LASTNAME)
                      .email(UnitTestData.EMAIL)
                      .build();
    }
}
]]>
</src>

<src name="LineMatcher" type="java" title="LineMatcher">
        <![CDATA[
public interface LineMatcher {
    boolean accept(int index, String value, String reference);

    boolean skip(int index, String value, String reference);

    boolean match(int index, String value, String reference);

    default boolean acceptReplace(int index, String value) {
        return false;
    }

    default String replace(int index, String value) {
        return value;
    }
}
]]>
</src>


<src name="UserRestClient" type="java" title="UserRestClient">
        <![CDATA[
@RequestMapping(path = "ws/user")
public interface UserRestClient {
    // =================================================================================================================
    // CREATE
    // =================================================================================================================
    @GenericHeaders
    @UserRestClientDOC.DocCreate
    @PostMapping(consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    Collection<UserAPI> create(@RequestBody final Collection<UserAPI> values);

    // =================================================================================================================
    // READ
    // =================================================================================================================
    @GenericHeaders
    @UserRestClientDOC.DocSearch
    @GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)
    SearchResponse<UserAPI> search(final UserDTOSearchRequestAPI searchRequest);

	// ...
}
]]>
</src>
<src name="UserAPI" type="java" title="UserAPI">
        <![CDATA[
@Getter
@Setter
@Builder(toBuilder = true)
@NoArgsConstructor
@AllArgsConstructor
@ToString(onlyExplicitlyIncluded = true)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class UserAPI  implements Serializable {

    private static final long serialVersionUID = -1256033411307961652L;
    @ToString.Include
    private String uid;
    @ToString.Include
    private String firstName;
    @ToString.Include
    private String lastName;
    @ToString.Include
    @EqualsAndHashCode.Include
    private String email;

    private AuditDTO audit;
}
]]>
</src>


<src name="UserRestClient" type="java" title="UserRestClient">
        <![CDATA[
@RequestMapping(path = "ws/user")
public interface UserRestClient {
    // =================================================================================================================
    // CREATE
    // =================================================================================================================
    @GenericHeaders
    @UserRestClientDOC.DocCreate
    @PostMapping(consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    Collection<UserAPI> create(@RequestBody final Collection<UserAPI> values);

    // =================================================================================================================
    // READ
    // =================================================================================================================
    @GenericHeaders
    @UserRestClientDOC.DocSearch
    @GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)
    SearchResponse<UserAPI> search(final UserDTOSearchRequestAPI searchRequest);

	// ...
}
]]>
</src>
<src name="UserRestController" type="java" title="UserRestController">
        <![CDATA[
@RequiredArgsConstructor
@Builder
@RestController
public class UserRestController implements UserRestClient {
    //==================================================================================================================
    // CREATE
    //==================================================================================================================
    private final IUserService  userService;
    private final UserAPIMapper userAPIMapper;

    //==================================================================================================================
    // CREATE
    //==================================================================================================================
    @Override
    public Collection<UserAPI> create(final Collection<UserAPI> values) {
        final var request = userAPIMapper.convertToCore(values);
        return userAPIMapper.convertToRest(userService.create(request));
    }
	// ...
}
]]>
</src>


<src name="UserRestControllerTest" type="java" title="UserRestControllerTest">
        <![CDATA[

@ExtendWith(MockitoExtension.class)
class UserRestControllerTest {
    //==================================================================================================================
    // ATTRIBUTES
    //==================================================================================================================
    private static final String BASE_FOLDER  = "interfaces/api/domain/user/userRestClient/";
    private static final String CREATE       = BASE_FOLDER + "create";
    private static final String GET_BY_ID    = BASE_FOLDER + "getById";
    private static final String SEARCH       = BASE_FOLDER + "search";
    private static final String UPDATE_FORCE = BASE_FOLDER + "updateForce";
    private static final String UPDATE       = BASE_FOLDER + "update";
    private static final String DELETE       = BASE_FOLDER + "delete";
    public static final  String BASE_PATH    = "/user";

    @Mock
    private IUserService userService;

    @AfterAll
    public static void generateOpenApi() {
        MockGenerator.generateOpenApiDocumentation(MockOpenApiContext.builder()
                                                                     .restClientClass(UserRestClient.class)
                                                                     .folders(List.of(CREATE, GET_BY_ID, SEARCH, UPDATE_FORCE, UPDATE, DELETE))
                                                                     .build());
    }

    //==================================================================================================================
    // CREATE
    //==================================================================================================================
    @Test
    void create_nominal() {
        when(userService.create(any())).thenReturn(List.of(buildUserDTO()));
        final var request  = List.of(buildUserAPI());
        final var response = controller().create(request);
        assertText(response, """
                [ {
                  "audit" : {
                    "createdBy" : "system",
                    "createdDate" : "2023-05-27T12:00:00",
                    "lastModifiedBy" : "user-1",
                    "lastModifiedDate" : "2023-06-01T12:00:00",
                    "version" : 1
                  },
                  "email" : "john.smith@mock.org",
                  "firstName" : "John",
                  "lastName" : "Smith",
                  "uid" : "bb895294-efe7-484b-b670-14d004eaf461"
                } ]
                """);

        MockGenerator.generate(MockContext.builder()
                                          .folder(CREATE)
                                          .post(BASE_PATH)
                                          .addRequestHeaderTracking()
                                          .addResponseHeaderTracking()
                                          .statusSuccess()
                                          .requestPayload(request)
                                          .responsePayload(response)
                                          .build());

        final List<ErrorCode> errors = List.of(CREATE_INVALID_DATA,
                                               CREATE_UID_FORBIDDEN,
                                               CREATE_FIRSTNAME_INVALID,
                                               CREATE_LASTNAME_INVALID,
                                               CREATE_EMAIL_INVALID);
        for (ErrorCode error : errors) {
            MockGenerator.generate(MockContext.builder()
                                              .folder(CREATE)
                                              .post(BASE_PATH)
                                              .addRequestHeaderTracking()
                                              .addResponseHeaderTracking()
                                              .statusSuccess()
                                              .requestPayload(request)
                                              .errorCode(error)
                                              .build());
        }
    }
	
	// ....
	//==================================================================================================================
    // TOOLS
    //==================================================================================================================
    private UserRestController controller() {
        return UserRestController.builder()
                                 .userService(userService)
                                 .userAPIMapper(new UserRestMapperConfiguration().userAPIMapper())
                                 .build();
    }

    private UserDTO buildUserDTO() {
        return UserDTO.builder()
                      .uid(UnitTestData.UID)
                      .firstName(UnitTestData.FIRSTNAME)
                      .lastName(UnitTestData.LASTNAME)
                      .email(UnitTestData.EMAIL)
                      .audit(AuditDTO.builder()
                                     .createdBy("system")
                                     .createdDate(UnitTestData.DATE_TIME.minusDays(5))
                                     .lastModifiedBy("user-1")
                                     .lastModifiedDate(UnitTestData.DATE_TIME)
                                     .version(1L)
                                     .build())
                      .build();
    }
}
]]>
</src>


<src name="generateOpenApiDocumentation" type="java" title="generateOpenApiDocumentation">
        <![CDATA[
@AfterAll
    public static void generateOpenApi() {
        MockGenerator.generateOpenApiDocumentation(MockOpenApiContext.builder()
                                                                     .restClientClass(UserRestClient.class)
                                                                     .folders(List.of(CREATE, GET_BY_ID, SEARCH, UPDATE_FORCE, UPDATE, DELETE))
                                                                     .build());
    }

]]>
</src>

<src name="context_json" type="json" title="REST mock context as json">
        <![CDATA[
{
  "contentType" : "application/json",
  "encoding" : "UTF-8",
  "request" : "[ {\n  \"email\" : \"john.smith@mock.org\",\n  \"firstName\" : \"John\",\n  \"lastName\" : \"Smith\"\n} ]",
  "requestHeaders" : {
    "x-device-identifier" : "a3bb49a3-b408-469f-8598-2f51bb7d4d74",
    "x-correlation-id" : "f525874d-dfe6-4ebf-b646-26996fe2625d"
  },
  "response" : "[ {\n  \"audit\" : {\n    \"createdBy\" : \"system\",\n    \"createdDate\" : \"2023-05-27T12:00:00\",\n    \"lastModifiedBy\" : \"user-1\",\n    \"lastModifiedDate\" : \"2023-06-01T12:00:00\",\n    \"version\" : 1\n  },\n  \"email\" : \"john.smith@mock.org\",\n  \"firstName\" : \"John\",\n  \"lastName\" : \"Smith\",\n  \"uid\" : \"bb895294-efe7-484b-b670-14d004eaf461\"\n} ]",
  "responseHeaders" : {
    "x-device-identifier" : "a3bb49a3-b408-469f-8598-2f51bb7d4d74",
    "x-correlation-id" : "f525874d-dfe6-4ebf-b646-26996fe2625d",
    "x-b3-traceid" : "c6a6c77e-3a39-49f5-9de1-5017ff0edacd"
  },
  "status" : 200,
  "url" : "/user",
  "verb" : "POST"
}
]]>
</src>



<src name="generateOpenApiDocumentation" type="java" title="generateOpenApiDocumentation">
        <![CDATA[
@AfterAll
    public static void generateOpenApi() {
        MockGenerator.generateOpenApiDocumentation(MockOpenApiContext.builder()
                                                                     .restClientClass(UserRestClient.class)
                                                                     .folders(List.of(CREATE, GET_BY_ID, SEARCH, UPDATE_FORCE, UPDATE, DELETE))
                                                                     .build());
    }

]]>
</src>

<src name="UserRestClientDOC" type="java" title="UserRestClientDOC">
        <![CDATA[

@UtilityClass
public class UserRestClientDOC  {
     @PotentialErrors({
          @PotentialError(errorCode="USER-1_0", httpStatus=400, type="functional", domain="USER", errorMessage="invalid data for user creation", errorMessageDetail="invalid data for user creation"),
          @PotentialError(errorCode="USER-1_1", httpStatus=400, type="functional", domain="USER", errorMessage="uid is forbidden for user creation", errorMessageDetail="uid is forbidden for user creation"),
          @PotentialError(errorCode="USER-1_2", httpStatus=400, type="functional", domain="USER", errorMessage="invalid firstname", errorMessageDetail="invalid firstname"),
          @PotentialError(errorCode="USER-1_3", httpStatus=400, type="functional", domain="USER", errorMessage="invalid lastname", errorMessageDetail="invalid lastname"),
          @PotentialError(errorCode="USER-1_4", httpStatus=400, type="functional", domain="USER", errorMessage="invalid email", errorMessageDetail="invalid email")
     })
     @ApiResponses({
         @ApiResponse(
         	responseCode="200",
         	description="Successful operation",
         	content={
                      @Content(
                      	mediaType="application/json",
                      	examples={                 
                                       @ExampleObject(
                                       	name="Nominal",
                                       	value="""
                                                [ {
                                                  "audit" : {
                                                    "createdBy" : "system",
                                                    "createdDate" : "2023-05-27T12:00:00",
                                                    "lastModifiedBy" : "user-1",
                                                    "lastModifiedDate" : "2023-06-01T12:00:00",
                                                    "version" : 1
                                                  },
                                                  "email" : "john.smith@mock.org",
                                                  "firstName" : "John",
                                                  "lastName" : "Smith",
                                                  "uid" : "bb895294-efe7-484b-b670-14d004eaf461"
                                                } ]
                                       """
                                       )
                      
                      	}
                      )
         		}
         	)
         ,
         @ApiResponse(
         	responseCode="400",
         	description="Functional error on executing operation",
         	content={
                      @Content(
                      	mediaType="application/json",
                      	examples={                 
                                       @ExampleObject(
                                       	name="Error codes",
                                       	value="""
                                                [
                                                "USER-1_0  |  functional  |  USER        |  invalid data for user creation",
                                                "USER-1_1  |  functional  |  USER        |  uid is forbidden for user creation",
                                                "USER-1_2  |  functional  |  USER        |  invalid firstname",
                                                "USER-1_3  |  functional  |  USER        |  invalid lastname",
                                                "USER-1_4  |  functional  |  USER        |  invalid email"
                                                ]
                                       """
                                       ),
                                       @ExampleObject(
                                       	name="Response with error code",
                                       	value="""
                                                {
                                                  "details" : {
                                                    "errorCode" : {
                                                      "statusCode" : 400,
                                                      "domain" : "USER",
                                                      "errorCode" : "USER-1_0",
                                                      "errorType" : "functional",
                                                      "message" : "invalid data for user creation",
                                                      "exploitationError" : false,
                                                      "rollbackRequire" : false,
                                                      "retryable" : false
                                                    }
                                                  },
                                                  "errors" : [ ],
                                                  "parameters" : [ ],
                                                  "status" : 400
                                                }
                                       """
                                       )
                      
                      	}
                      )
         		}
         	)
     })
     @Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})
     @Retention(RetentionPolicy.RUNTIME)
     @Inherited
     public @interface DocCreate  {}

	 // ...
}
]]>
</src>


<src name="UserRestClient_withDoc" type="java" title="UserRestClient">
        <![CDATA[
@RequestMapping(path = "ws/user")
public interface UserRestClient {
    
    @GenericHeaders
    @UserRestClientDOC.DocCreate
    @PostMapping(consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    Collection<UserAPI> create(@RequestBody final Collection<UserAPI> values);
	// ...
}
]]>
</src>

<src name="assembly" type="xml" title="Build assembly and OpenApi contracts">
        <![CDATA[
	<!--================================================================================================================
    = BUILD
    =================================================================================================================-->
    <build>
        <plugins>
            <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
            + GENERATE OPEN API CONTRACTS
            +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
            <plugin>
                <groupId>io.github.kbuntrock</groupId>
                <artifactId>openapi-maven-plugin</artifactId>
                <version>0.0.28</version>
                <executions>
                    <execution>
                        <id>documentation-global</id>
                        <goals>
                            <goal>documentation</goal>
                        </goals>
                        <phase>compile</phase>
                        <configuration>
                            <apiConfiguration>
                                <library>SPRING_MVC</library>
                                <tagAnnotations>
                                    <annotation>RequestMapping</annotation>
                                </tagAnnotations>
                            </apiConfiguration>
                            <apis>
                                <api>
                                    <locations>
                                        <location>com.my.project.interfaces.api.domain</location>
                                    </locations>
                                </api>
                            </apis>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
            + GENERATE OPEN API CONTRACTS
            +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-assembly-plugin</artifactId>
                <executions>
                    <execution>
                        <id>mocks</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <descriptors>
                                <descriptor>src/assembly/assembly.xml</descriptor>
                            </descriptors>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
]]>
</src>


<src name="ProjectFeignConfiguration" type="java" title="ProjectFeignConfiguration">
        <![CDATA[
	@Configuration
public class ProjectFeignConfiguration {
    public static final String PACKAGE = "com.my.project.interfaces.feign";

    @ConditionalOnMissingBean
    @Bean
    public PartnerConfigurationDTO demoPartnerConfiguration(@Value("${application.partners.demo.baseUrl: http://localhost:8080}") final String baseUrl,
                                                               @Value("${application.partners.demo.user: #{null}}") final String user,
                                                               @Value("${application.partners.demo.password: #{null}}") final String password) {
        return PartnerConfigurationDTO.builder()
                                      .baseUrl(baseUrl)
                                      .user(user)
                                      .password(password)
                                      .build();
    }

    @Bean
    public FeignBuilder inugamiFeignBuilder(final Client client,
                                            final Encoder encoder,
                                            final Decoder decoder,
                                            final PartnerConfigurationDTO inugamiPartnerConfiguration,
                                            final List<RequestInterceptor> interceptors,
                                            final Contract contract) {
        return FeignBuilder.builder()
                           .client(client)
                           .encoder(encoder)
                           .decoder(decoder)
                           .partnerConfiguration(inugamiPartnerConfiguration)
                           .interceptors(interceptors)
                           .contract(contract)
                           .build()
                           .init();
    }

    //==================================================================================================================
    // CLIENTS
    //==================================================================================================================
    @Bean
    public UserRestClient userRestClient(final FeignBuilder inugamiFeignBuilder) {
        return inugamiFeignBuilder.buildClient(UserRestClient.class);
    }
}
]]>
</src>


<src name="Application" type="java" title="Application">
        <![CDATA[
@ComponentScan(basePackages={
        ConfigConfiguration.INUGAMI,
        "com.my.project"
})
@EnableAutoConfiguration
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}

]]>
</src>


<src name="webapp_module" type="java" title="Webapp module">
        <![CDATA[
open module com.my.project.interfaces.feign {
    requires com.my.project.interfaces.api;
    requires feign.core;
    requires feign.jackson;
    requires feign.okhttp;
    requires io.inugami.framework.commons.spring;
    requires io.inugami.framework.interfaces;
    requires io.inugami.monitoring.springboot;
    requires spring.beans;
    requires spring.boot.autoconfigure;
    requires spring.cloud.openfeign.core;
    requires spring.context;

    exports com.my.project.interfaces.feign;
}
]]>
</src>


</xml>