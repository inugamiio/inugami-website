<xml>
    <src name="dependencies_maven" type="xml" title="Maven dependencies">
        <![CDATA[
<dependency>
    <groupId>io.inugami.framework</groupId>
    <artifactId>inugami_api_interfaces</artifactId>
</dependency>
]]>
    </src>

        <src name="dependencies_java" type="java" title="Java dependencies">
        <![CDATA[
requires io.inugami.framework.interfaces;
]]>
    </src>


    <src name="ActionWithException" type="java" title="ActionWithException">
        <![CDATA[
@FunctionalInterface
public interface ActionWithException {
    <T> T process() throws Throwable;
}
]]>
    </src>

        <src name="ActionWithExceptionUsage" type="java" title="Usage of ActionWithException">
        <![CDATA[
@UtilityClass
public class Asserts {
    //...
    public static <T> T wrapErrorForSupplierWithException(final ActionWithException action, final ErrorCode errorCode) {
        return wrapErrorForSupplierWithException(action, errorCode, null);
    }
}

public class UserService{
    // ...

    public void getUserById(final String id) {
        final UserDTO user = Asserts.wrapErrorForSupplierWithException(()-> userDao.getElementById(id),
                                                                        UserError.READ_USER_NOT_FOUND);
    }
}
]]>
    </src>

<src name="BiConsumerWithException" type="java" title="BiConsumerWithException">
        <![CDATA[
@FunctionalInterface
public interface BiConsumerWithException<T,V> {
    void process(final T value, final V secondValue) throws Exception;
}
]]>
    </src>

    <src name="BiConsumerWithException" type="java" title="BiConsumerWithException">
        <![CDATA[
@FunctionalInterface
public interface BiConsumerWithException<T,V> {
    void process(final T value, final V secondValue) throws Exception;
}
]]>
    </src>

        <src name="BiConsumerWithExceptionUsage" type="java" title="Usage of BiConsumerWithException">
        <![CDATA[
@UtilityClass
public class Asserts {
    //...
    public <T> void assertModel(final Collection<T> models,
                                final BiConsumerWithException<T, Integer>... validations) {
        // ...
    }
}


@RequiredArgsConstructor
@Service
public class UserService{
    @Transactional
    public Collection<UserDTO> create(final Collection<UserDTO> values) {
        assertNotEmpty(CREATE_INVALID_DATA, values);

        assertModel(values,
            (v, index) -> assertNull(fromErrorCode(CREATE_UID_FORBIDDEN)
                            .addField(FIELD_UID, index)
                            .build(), v.getUid()),

            (v, index) -> {
                assertNotEmpty(fromErrorCode(CREATE_FIRSTNAME_INVALID)
                            .addField(FIELD_FIRSTNAME, index)
                            .build(), v.getFirstName());

                v.setFirstName(v.getFirstName().trim());
                assertLowerOrEquals(fromErrorCode(CREATE_FIRSTNAME_INVALID)
                            .addField(FIELD_FIRSTNAME, index)
                            .build(), MAX_SIZE, v.getFirstName().length());
            },

            (v, index) -> {
                assertNotEmpty(fromErrorCode(CREATE_LASTNAME_INVALID)
                            .addField(FIELD_LASTNAME, index)
                            .build(), v.getLastName());
                v.setLastName(v.getLastName().trim());
                assertLowerOrEquals(fromErrorCode(CREATE_LASTNAME_INVALID)
                            .addField(FIELD_LASTNAME, index)
                            .build(), MAX_SIZE, v.getLastName().length());
            },

            (v, index) -> {
                assertNotEmpty(fromErrorCode(CREATE_EMAIL_INVALID)
                            .addField(FIELD_EMAIL, index)
                            .build(), v.getEmail());
                v.setEmail(v.getEmail().trim());
                assertRegexMatch(fromErrorCode(CREATE_EMAIL_INVALID)
                            .addField(FIELD_EMAIL, index)
                            .build(), EMAIL_REGEX, v.getEmail());
            });

        return userDao.create(values);
    }
]]>
    </src>


<src name="ConsumerWithException" type="java" title="ConsumerWithException">
        <![CDATA[
@FunctionalInterface
public interface ConsumerWithException<T> {
    void process(final T value) throws Exception;
}
]]>
    </src>

    <src name="ConsumerWithExceptionUsage" type="java" title="Usage of ConsumerWithException">
        <![CDATA[
@RequiredArgsConstructor
@Service
public class UserService {
    private final UserDao dao;
    private final List<ConsumerWithException<UserDTO>> listeners;

    @Transactional
    void synchronizeUsers(){
         List<UserDTO> users = dao.searchUserToSynchronize();

         users.forEach(this::invokeListeners);
    }

    protected void invokeListeners(UserDTO user ){
        for(ConsumerWithException<UserDTO> listener : listeners){
            RunSafeUtils.runSafeVoid(()-> listener.process(user));
        }
    }
}
]]>
    </src>

<src name="BiConsumerWithException" type="java" title="BiConsumerWithException">
        <![CDATA[
@FunctionalInterface
public interface BiConsumerWithException<T,V> {
    void process(final T value, final V secondValue) throws Exception;
}
]]>
    </src>

<src name="FilterFunction" type="java" title="FilterFunction">
        <![CDATA[
@FunctionalInterface
public interface FilterFunction<T> {
    boolean accept(final T input);
}
]]>
    </src>

<src name="FunctionWithException" type="java" title="FunctionWithException">
        <![CDATA[
@FunctionalInterface
public interface FunctionWithException<I, O, E extends Throwable> {
    O process(final I input) throws E;
}
]]>
    </src>


<src name="GenericActionWithException" type="java" title="GenericActionWithException">
        <![CDATA[
@FunctionalInterface
public interface GenericActionWithException<T> {
    T process() throws Throwable;
}
]]>
    </src>

    <src name="VoidFunction" type="java" title="VoidFunction">
        <![CDATA[
@FunctionalInterface
public interface VoidFunction {
    void process();
}
]]>
    </src>

    <src name="VoidFunctionWithException" type="java" title="VoidFunctionWithException">
        <![CDATA[
@FunctionalInterface
public interface VoidFunctionWithException {
    void process() throws Exception;
}
]]>
    </src>

    <src name="ValidatorFunction" type="java" title="ValidatorFunction">
        <![CDATA[
@FunctionalInterface
public interface ValidatorFunction<T, E extends Exception> {
    void validate(final T input) throws E;
}
]]>
    </src>

    <src name="IsEmptyFacet" type="java" title="IsEmptyFacet">
        <![CDATA[
@FunctionalInterface
public interface IsEmptyFacet {
    boolean isEmpty();
}
]]>
    </src>

    <src name="PostProcessing" type="java" title="PostProcessing">
        <![CDATA[
@FunctionalInterface
public interface PostProcessing<T> {
    void postProcessing(final T context) throws TechnicalException;
}
]]>
    </src>

    <src name="SupplierWithException" type="java" title="SupplierWithException">
        <![CDATA[
@FunctionalInterface
public interface SupplierWithException<T, E extends Exception> {
    T get() throws E;
}
]]>
    </src>

    <src name="SupplierWithThrowable" type="java" title="SupplierWithThrowable">
        <![CDATA[
@FunctionalInterface
public interface SupplierWithThrowable<T> {
    T get() throws Throwable;
}
]]>
    </src>

    <src name="TaskStartListener" type="java" title="TaskStartListener">
        <![CDATA[
@FunctionalInterface
public interface TaskStartListener {
    void onStart(final long time, final String name);
}
]]>
    </src>

    <src name="TaskFinishListener" type="java" title="TaskFinishListener">
        <![CDATA[
@FunctionalInterface
public interface TaskFinishListener {
    void onFinish(final long time, final long delay, final String name, final Object result, final Exception error);
}
]]>
    </src>
</xml>
