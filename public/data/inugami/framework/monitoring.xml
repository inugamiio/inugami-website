<xml>
    <src name="dependencies_maven" type="xml" title="Maven dependencies">
        <![CDATA[
<dependency>
    <groupId>io.inugami.framework</groupId>
    <artifactId>inugami_api_interfaces</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.framework.commons</groupId>
    <artifactId>inugami_commons_spring</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.monitoring</groupId>
    <artifactId>inugami_monitoring_springboot</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.monitoring</groupId>
    <artifactId>inugami_monitoring_core</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.monitoring</groupId>
    <artifactId>inugami_logs_obfuscator</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.monitoring</groupId>
    <artifactId>inugami_monitoring_springboot</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.monitoring.sensors</groupId>
    <artifactId>inugami_monitoring_sensors_default</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.monitoring.providers</groupId>
    <artifactId>inugami_monitoring_providers_log</artifactId>
</dependency>

<dependency>
    <groupId>io.inugami.framework.commons</groupId>
    <artifactId>inugami_commons_test</artifactId>
    <scope>test</scope>
</dependency>

<!-- If you use activeMQ -->
<dependency>
    <groupId>io.inugami.monitoring</groupId>
    <artifactId>inugami_monitoring_springboot_activemq</artifactId>
</dependency>
]]>
    </src>

        <src name="dependencies_java" type="java" title="Java dependencies">
        <![CDATA[
requires io.inugami.framework.commons.spring;
requires io.inugami.framework.interfaces;
requires io.inugami.logs.obfuscator ;
requires io.inugami.monitoring.core;
requires io.inugami.monitoring.providers.logs;
requires io.inugami.monitoring.sensors.defaults;
requires io.inugami.monitoring.springboot;
// If you use activeMQ 
requires io.inugami.monitoring.springboot.activemq;
]]>
    </src>

            <src name="module_java_webapp" type="java" title="Webapp module-info.java">
        <![CDATA[
open module com.my.project.webapp {
    // Project
    requires com.my.project.api;
    requires com.my.project.core;
    requires com.my.project.infrastructure;
    requires com.my.project.interfaces.api;
    requires com.my.project.interfaces.core;

    // Inugami Core & Interfaces
    requires io.inugami.framework.api;
    requires io.inugami.framework.commons.spring.data;
    requires io.inugami.framework.commons.spring;
    requires io.inugami.framework.commons;
    requires io.inugami.framework.interfaces;

    // Monitoring & Logging
    requires io.inugami.logs.obfuscator;
    requires io.inugami.monitoring.providers.logs;
    requires io.inugami.monitoring.sensors.defaults;
    requires io.inugami.monitoring.springboot;

    // Spring
    requires org.springdoc.openapi.ui;
    requires org.springdoc.openapi.webmvc.core;
    requires spring.boot.autoconfigure;
    requires spring.boot.starter.actuator;
    requires spring.boot.starter.tomcat;
    requires spring.boot;
    requires spring.context;
    requires spring.tx;

    // Tools
    requires lombok;
    requires org.jspecify;
    requires org.mapstruct;
    requires org.slf4j;
}
]]>
    </src>

               <src name="elastic_appender" type="xml" title="Logback Inugami appender">
        <![CDATA[
<appender name="ELASTIC-DEFAULT" class="io.inugami.logs.obfuscator.appender.JsonAppender">
    <configuration>
        <mode>elasticSearch</mode>
        <host>http://localhost:9200/_bulk</host>
        <headersMap>
               {
                 "someHeader" : "myValue"
               }
        </headersMap>
        <index>dev-demo-logs</index>
        <indexDatePattern>yyyy-MM-dd</indexDatePattern>
    </configuration>
    <encoder class="io.inugami.logs.obfuscator.encoder.ObfuscatorEncoder">
        <configuration>
            <forceNewLine>true</forceNewLine>
            <encodeAsJson>true</encodeAsJson>
            <additionalFields>
                {
                "groupId":"com.my.project",
                "artifactId":"demo-webapp"
                }
            </additionalFields>
        </configuration>
        <pattern>%m%n</pattern>
    </encoder>
</appender>
]]>
    </src>

    <src name="logback_full" type="xml" title="Full logback.xml configuration">
        <![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!--================================================================================================================
    = APPENDER
    =================================================================================================================-->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>[%d{dd/MM HH:mm:ss}]|%logger|%-5level|%thread|%msg\n</pattern>
        </encoder>
    </appender>
    <appender name="ASYNC_STDOUT" class="ch.qos.logback.classic.AsyncAppender">
        <appender-ref ref="STDOUT" />
    </appender>

    <appender name="ELASTIC-DEFAULT" class="io.inugami.logs.obfuscator.appender.JsonAppender">
        <configuration>
            <mode>elasticSearch</mode>
            <host>http://localhost:9200/_bulk</host>
            <index>dev-demo-logs</index>
            <indexDatePattern>yyyy-MM-dd</indexDatePattern>
        </configuration>
        <encoder class="io.inugami.logs.obfuscator.encoder.ObfuscatorEncoder">
            <configuration>
                <forceNewLine>true</forceNewLine>
                <encodeAsJson>true</encodeAsJson>
                <additionalFields>
                    {
                    "groupId":"com.my.project",
                    "artifactId":"demo-webapp"
                    }
                </additionalFields>
            </configuration>
            <pattern>%m%n</pattern>
        </encoder>
    </appender>

    <appender name="ELASTIC-IOLOG" class="io.inugami.logs.obfuscator.appender.JsonAppender">
        <configuration>
            <mode>elasticSearch</mode>
            <host>http://localhost:9200/_bulk</host>
            <index>dev-demo-iologs</index>
            <indexDatePattern>yyyy-MM-dd</indexDatePattern>
        </configuration>
        <encoder class="io.inugami.logs.obfuscator.encoder.ObfuscatorEncoder">
            <configuration>
                <forceNewLine>true</forceNewLine>
                <encodeAsJson>true</encodeAsJson>
                <additionalFields>
                    {
                    "groupId":"com.my.project",
                    "artifactId":"demo-webapp"
                    }
                </additionalFields>
            </configuration>
            <pattern>%m%n</pattern>
        </encoder>
    </appender>

    <appender name="ELASTIC-PARTNERLOG" class="io.inugami.logs.obfuscator.appender.JsonAppender">
        <configuration>
            <mode>elasticSearch</mode>
            <host>http://localhost:9200/_bulk</host>
            <index>dev-demo-partnerlog</index>
            <indexDatePattern>yyyy-MM-dd</indexDatePattern>
        </configuration>
        <encoder class="io.inugami.logs.obfuscator.encoder.ObfuscatorEncoder">
            <configuration>
                <forceNewLine>true</forceNewLine>
                <encodeAsJson>true</encodeAsJson>
                <additionalFields>
                    {
                    "groupId":"com.my.project",
                    "artifactId":"demo-webapp"
                    }
                </additionalFields>
            </configuration>
            <pattern>%m%n</pattern>
        </encoder>
    </appender>

    <appender name="ELASTIC-XLLOG" class="io.inugami.logs.obfuscator.appender.JsonAppender">
        <configuration>
            <mode>elasticSearch</mode>
            <host>http://localhost:9200/_bulk</host>
            <index>dev-demo-xllog</index>
            <indexDatePattern>yyyy-MM-dd</indexDatePattern>
        </configuration>
        <encoder class="io.inugami.logs.obfuscator.encoder.ObfuscatorEncoder">
            <configuration>
                <forceNewLine>true</forceNewLine>
                <encodeAsJson>true</encodeAsJson>
                <additionalFields>
                    {
                    "groupId":"com.my.project",
                    "artifactId":"demo-webapp"
                    }
                </additionalFields>
            </configuration>
            <pattern>%m%n</pattern>
        </encoder>
    </appender>
    <appender name="ELASTIC-METRICS" class="io.inugami.logs.obfuscator.appender.JsonAppender">
        <configuration>
            <mode>elasticSearch</mode>
            <host>http://localhost:9200/_bulk</host>
            <index>dev-demo-metrics</index>
            <indexDatePattern>yyyy-MM-dd</indexDatePattern>
        </configuration>
        <encoder class="io.inugami.logs.obfuscator.encoder.ObfuscatorEncoder">
            <configuration>
                <forceNewLine>true</forceNewLine>
                <encodeAsJson>false</encodeAsJson>
                <additionalFields>
                    {
                    "groupId":"com.my.project",
                    "artifactId":"demo-webapp"
                    }
                </additionalFields>
            </configuration>
            <pattern>%m%n</pattern>
        </encoder>
    </appender>
    <!--================================================================================================================
    = LOGGERS
    =================================================================================================================-->
    <logger name="org.springframework">
        <level value="INFO"/>
    </logger>
    <logger name="org.hibernate">
        <level value="INFO"/>
    </logger>
    <logger name="logging.level.org.hibernate.SQL">
        <level value="DEBUG"/>
    </logger>

    <logger name="io.inugami">
        <level value="INFO"/>
    </logger>
    <logger name="com.zaxxer">
        <level value="INFO"/>
    </logger>

    <logger name="IOLOG" additivity="false">
        <level value="INFO"/>
        <appender-ref ref="ELASTIC-IOLOG" />
        <appender-ref ref="ASYNC_STDOUT" />

    </logger>

    <logger name="PARTNERLOG" additivity="false">
        <level value="INFO"/>
        <appender-ref ref="ELASTIC-PARTNERLOG" />
        <appender-ref ref="ASYNC_STDOUT" />
    </logger>


    <logger name="XLLOG" additivity="false">
        <level value="INFO"/>
        <appender-ref ref="ELASTIC-XLLOG" />
        <appender-ref ref="ASYNC_STDOUT" />
    </logger>

    <logger name="METRICS_LOG_SENDER" additivity="false">
        <level value="INFO"/>
        <appender-ref ref="ELASTIC-METRICS" />
    </logger>

    <!--================================================================================================================
    = ROOT
    =================================================================================================================-->
    <root level="DEBUG">
        <appender-ref ref="ASYNC_STDOUT"/>
        <appender-ref ref="ELASTIC-DEFAULT"/>
    </root>

</configuration>
]]>
    </src>

                   <src name="application.yaml" type="yaml" title="application.yaml">
        <![CDATA[
env: DEV
application:
  groupId: "@project.groupId@"
  artifactId: "@project.artifactId@"
  version: "@project.version@"
  commitId: "@commitId@"
  commitDate: "@commitDate@"
  name: "demo"
  wiki: "https://inugami.io/mock/error/{0}/{1}"
  instanceName: "inu"
  instanceNumber: "001"

inugami:
  monitoring:
    interceptors:
      kpi:
        enabled: true
    internal:
      interval: 10000
    iolog:
      enabled: false
    interceptor:
      url:
        skip: .*api-docs.*;.*swagger-ui.*
    exception:
      show:
        detail:
          enabled: true  
]]>
    </src>

                       <src name="springboot_application" type="java" title="SpringBoot application">
        <![CDATA[
@ComponentScan(basePackages={
        ConfigConfiguration.INUGAMI,
        "com.my.project"
})
@EnableAutoConfiguration
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
]]>
    </src>
    
    <src name="docker_compose" type="yaml" title="local-integration-test/docker-compose.yaml">
        <![CDATA[
version: "3"
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:9.2.3
    container_name: elasticsearch
    environment:
      - xpack.security.enabled=false
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - ./elasticsearch/data:/usr/share/elasticsearch/data
    deploy:
      resources:
        limits:
          memory: 1gb
    networks:
      - elk-net
    ports:
      - "9200:9200"
      - "9300:9300"
  kibana:
    image: docker.elastic.co/kibana/kibana:9.2.3
    container_name: kibana
    environment:
      - xpack.security.enabled=false
    networks:
      - elk-net
    ports:
      - "5601:5601"
    depends_on:
      - elasticsearch

networks:
  elk-net:
    driver: bridge
]]>
    </src>

        
    <src name="docker_compose_up" type="bash" title="run elastic search stack">
        <![CDATA[
cd local-integration-test/
docker-compose up
]]>
    </src>

            
    <src name="iolog_example" type="text" title="IOLOG example">
        <![CDATA[
[POST] /ws/user
headers :
	accept: */*
	accept-encoding: gzip, deflate, br
	cache-control: no-cache
	connection: keep-alive
	content-length: 116
	content-type: application/json
	cookie: xxxxx
	host: localhost:8080
	postman-token: 6e9db44e-1e3c-4484-93f9-4008409e2146
	user-agent: PostmanRuntime/7.29.2
payload :
[
    {
        "firstName":"John",
        "lastName":"Smith",
        "email":"john.smith.mock@inugami.io"
    }
]
response:
	status:200
	datetime:1767863249411
	duration:11
	contentType:application/json
	headers:
		Access-Control-Allow-Credentials: true
		Access-Control-Allow-Headers: xxxxx
		Access-Control-Allow-Origin: *
		Access-Control-Expose-Headers: xxxxx
		accept: */*
		accept-encoding: gzip, deflate, br
		cache-control: no-cache
		connection: keep-alive
		content-length: 116
		content-type: application/json
		cookie: xxxxx
		host: localhost:8080
		postman-token: 6e9db44e-1e3c-4484-93f9-4008409e2146
		user-agent: PostmanRuntime/7.29.2
		x-b3-traceid: 50aa5a3f-b764-4ba7-8b2f-7fe23d09c69a
		x-correlation-id: 1b3682bc-c9c1-4506-aff4-b50cac1fd31b
		x-device-identifier: 2f411cae-e3b4-4465-b86a-e001c2b64d74
	payload:[{"audit":{"createdBy":"system","createdDate":"2026-01-08T09:07:29.407874129","version":1},"email":"john.smith.mock@inugami.io","firstName":"John","lastName":"Smith","uid":"9c40c536-9c71-4b8d-a443-89a79e8068dd"}]
]]>
    </src>


    <src name="ioLogContentDisplayResolverSPI" type="java" title="Implementation of IoLogContentDisplayResolverSPI">
        <![CDATA[
@Component
public class MyIoLogContentDisplayResolver interface IoLogContentDisplayResolverSPI {
    public boolean display(final RequestData request){
        // implementation
    }
}
]]>
    </src>

        <src name="RequestData" type="java" title="RequestData">
        <![CDATA[
@Builder(toBuilder = true)
@AllArgsConstructor
@ToString
@Getter
@Setter
public class RequestData implements Serializable {

    // =========================================================================
    // ATTRIBUTES
    // =========================================================================
    private static final long                  serialVersionUID = -7805638130853062376L;
    private              String                uri;
    private              String                contextPath;
    private              String                contentType;
    private              String                method;
    private              String                characterEncoding;
    private              String                content;
    private              Map<String, String[]> options;
    private              HttpServletRequest    request;
    private              HttpServletResponse   response;
    // server
    private              String                env;

    private String asset;

    private String hostname;

    private String instanceName;

    private String instanceNumber;

    // tracking
    private String correlationId;

    private String requestId;
    private String traceId;

    private String conversationId;

    private String sessionId;

    private String token;

    // application
    private String applicationVersion;

    private String service;

    // devices
    private String deviceIdentifier;

    private String deviceType;

    private String deviceClass;

    private String version;

    private String majorVersion;

    private String osVersion;

    private String deviceNetworkType;

    private Double deviceNetworkSpeedDown;

    private Double deviceNetworkSpeedUp;

    private Double deviceNetworkSpeedLatency;

    // IPs
    private String remoteAddress;

    private String deviceIp;

    private String userAgent;

    // language
    private String              language;
    private String              country;
    private Map<String, String> headers;
    private String              callFrom;
}
]]>
    </src>

    <src name="PARTNERLOG" type="java" title="PARTNERLOG">
        <![CDATA[
INFO [PARTNERLOG:42] - [POST] http://inugami.io/mock/user
request:
	headers:
		auth : xxxxx
		Content-Length : 480"
		x-b3-traceid : 3d623248-5d0e-4be0-830f-d95593e6dcc7
		x-correlation-id : ba26cf88-a6ee-40e2-83cf-89ebf11eeb35
		x-device-identifier : 47991fbc-529a-42e3-9ac6-9d7992713250
	payload:
{
  "birthday" : "1988-04-12",
  "canton" : "VD",
  "city" : "Cheseaux-sur-Lausanne",
  "deviceIdentifier" : "401f0498-c43f-43ad-a3f4-2888838332ad",
  "email" : "emilie.lalonde@mock.org",
  "firstName" : "Émilie",
  "id" : 1,
  "lastName" : "Lalonde",
  "nationality" : "CH",
  "old" : 35,
  "phoneNumber" : "0615031522",
  "sex" : "FEMALE",",
  "socialId" : "7564971247732",
  "streetName" : "du Château",
  "streetNumber" : "10",
  "streetType" : "Chem.",
  "zipCode" : "1033"
}
]]>
    </src>


    <src name="XLLOG_usage" type="java" title="Usage">
        <![CDATA[
Loggers.XLLOG.error("unable to call partner : {}", partnerName);
]]>
    </src>


    <src name="inugami_logs_obfuscator" type="xml" title="inugami_logs_obfuscator maven dependency">
        <![CDATA[
<dependency>
    <groupId>io.inugami.monitoring</groupId>
    <artifactId>inugami_logs_obfuscator</artifactId>
</dependency>
]]>
    </src>

        <src name="logback_obfuscator" type="xml" title="Logback configuration with dynamic masking">
        <![CDATA[
<appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder  class="io.inugami.logs.obfuscator.encoder.ObfuscatorEncoder">
        <pattern>[%d{dd/MM HH:mm:ss}]|%logger|%-5level|%thread|%msg\n</pattern>
    </encoder>
</appender>
]]>
    </src>
    

        <src name="my_module_obfuscator" type="java" title="Configure SPI implementations">
        <![CDATA[
open module com.demo.module {
    provides io.inugami.framework.interfaces.monitoring.logger.ObfuscatorSpi with com.demo.module.UserEmail;
}
]]>
    </src>
            <src name="emailObfuscator" type="java" title="Email masking">
        <![CDATA[
public class EmailObfuscator implements ObfuscatorSpi {

    // =========================================================================
    // ATTRIBUTES
    // =========================================================================
    public static final  String  EMAIL = "email";
    private static final Pattern REGEX = buildJsonRegex(EMAIL);

    private final boolean enabled = enabled();

    // =========================================================================
    // CONSTRUCTORS
    // =========================================================================
    @Override
    public boolean isEnabled() {
        return enabled;
    }

    // =========================================================================
    // API
    // =========================================================================
    @Override
    public boolean accept(final LogEventDto event) {
        return contains(event.getMessage(), EMAIL, EMAIL.toLowerCase(), EMAIL.toUpperCase());
    }

    @Override
    public String obfuscate(final LogEventDto event) {
        return replaceAll(event.getMessage(), REGEX, value ->  "xxx"+QUOT);
    }
}
]]>
    </src>

                <src name="emailObfuscatorTest" type="java" title="Test your email masking">
        <![CDATA[
class EmailObfuscatorTest {

    @Test
    void accept_withPassword_shouldAccept() {
        ObfuscatorSpi obfuscator = new EmailObfuscator();
        assertThat(obfuscator.accept(buildEvent(" \"Authorization\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6Ikp\""))).isFalse();
        assertThat(obfuscator.accept(buildEvent(" \"email\":\"john.smith@mock.inugami.io\""))).isTrue();
    }

    @Test
    void obfuscate_withPassword_shouldObfuscate() {
        ObfuscatorSpi obfuscator = new EmailObfuscator();
        assertThat(obfuscator.obfuscate(buildEvent(" \"email\":\"john.smith@mock.inugami.io\"")))
                .isEqualTo(" \"email\":\"xxx\"");
    }

    @Test
    void isEnabled_nominal() {
        ObfuscatorSpi obfuscator = new EmailObfuscator();
        assertThat(obfuscator.enabled()).isTrue();
    }

    private LogEventDto buildEvent(final String message) {
        return LogEventDto.builder()
                          .message(message)
                          .build();
    }
}
]]>
    </src>
      

    <src name="servicesSensor_addData" type="java" title="Add metrics to Service sensor">
<![CDATA[
@RequiredArgsConstructor
@Service
public class UserService implements IUserService {
    //==================================================================================================================
    // ATTRIBUTES
    //==================================================================================================================
    // ...

    //==================================================================================================================
    // CREATE
    //==================================================================================================================
    @Transactional
    @Override
    public Collection<UserDTO> create(final Collection<UserDTO> values) {
        //... validation
        addKpi(values);
        return userDao.create(values);
    }

    protected void addKpi(final Collection<UserDTO> values) {
        Map<String, Long> buffer = new LinkedHashMap<>();
        for (var user : values) {
            final String domain = user.getEmail().split("@")[1];
            if (buffer.containsKey(domain)) {
                buffer.put(domain, buffer.get(domain) + 1);
            } else {
                buffer.put(domain, 1L);
            }
        }

        for (var entry : buffer.entrySet()) {
            ServicesSensor.addData(List.of(GenericMonitoringModelDTO.builder()
                                                                    .addCallType(GenericModelCallType.REST)
                                                                    .addCounterType(GenericModelCounterType.HITS)
                                                                    .service("user")
                                                                    .subService("email_domain")
                                                                    .valueType(entry.getKey())
                                                                    .value(entry.getValue())
                                                                    .build()));
        }

    }
}
]]>
    </src>

    <src name="GenericMonitoringModelDTO" type="java" title="GenericMonitoringModelDTO">
<![CDATA[
@Slf4j
@ToString(onlyExplicitlyIncluded = true)
@Builder(toBuilder = true)
@NoArgsConstructor
@AllArgsConstructor(access = AccessLevel.PRIVATE)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
@Setter
@Getter
public class GenericMonitoringModelDTO implements GenericMonitoringModel, Identifiable<String> {

    private static final long          serialVersionUID = 4735410638475899702L;
    public static final  String        EMPTY            = "";
    public static final  String        SEPARATOR        = ":";
    public static final  String        ANY              = "ANY";
    public static final  String        NONE             = "NONE";
    public static final  String        CALL_TYPE_REST   = "REST";
    public static final  String        CALL_TYPE_JMS    = "JMS";
    private              String        uid;
    @EqualsAndHashCode.Include
    private              String        asset;
    @EqualsAndHashCode.Include
    private              String        environment;
    @EqualsAndHashCode.Include
    private              String        instanceName;
    @EqualsAndHashCode.Include
    private              String        instanceNumber;
    @EqualsAndHashCode.Include
    private              String        counterType;
    @EqualsAndHashCode.Include
    private              String        device;
    @EqualsAndHashCode.Include
    private              String        callType;
    @EqualsAndHashCode.Include
    private              String        service;
    @EqualsAndHashCode.Include
    private              String        subService;
    @EqualsAndHashCode.Include
    private              String        valueType;
    @EqualsAndHashCode.Include
    private              String        timeUnit;
    private              LocalDateTime date;
    private              long          time;
    private              String        errorCode;
    private              String        errorType;
    private              Object        value;
    @ToString.Include
    private              String        path;
    private              String        data;
    private              long          timestamp;
    private              String        groupId;
    private              String        artifactId;
    private              String        version;
    private              String        commitId;
    private              String        commitDate;


    // =========================================================================
    // GETTERS & SETTERS
    // =========================================================================
    @Override
    public boolean isUidSet() { }

    public String getNonTemporalHash() {  }



    public static class GenericMonitoringModelDTOBuilder {
        public GenericMonitoringModelDTOBuilder from(final GenericMonitoringModel other) { }

        public GenericMonitoringModelDTOBuilder addCallType(final GenericModelCallType value) { }

        public GenericMonitoringModelDTOBuilder addCounterType(final GenericModelCounterType value) { }
    }
}
]]>
    </src>


     <src name="MonitoringSensor" type="java" title="MonitoringSensor">
<![CDATA[
public interface MonitoringSensor extends NamedSpi {

    MonitoringSensor buildInstance(final long interval,
                                   final String query,
                                   final ConfigHandler<String, String> configuration,
                                   final MonitoringContextDTO context);


    long getInterval();

    List<GenericMonitoringModel> process();

    default void shutdown() {
    }
}
]]>
    </src>



     <src name="MonitoringSensorExample" type="java" title="Implement MonitoringSensor">
<![CDATA[
@Component
public class MySensor implements MonitoringSensor {

    public MonitoringSensor buildInstance(final long interval,
                                   final String query,
                                   final ConfigHandler<String, String> configuration,
                                   final MonitoringContextDTO context){
                return this;
     }


    public long getInterval(){
        return 60000L;
    }


    public List<GenericMonitoringModel> process(){
        return List.of(GenericMonitoringModelDTO.builder()
                                                .addCallType(GenericModelCallType.REST)
                                                .addCounterType(GenericModelCounterType.HITS)
                                                .service("user")
                                                .subService("email_domain")
                                                .valueType("inugami.io")
                                                .value(1)
                                                .build());
    }
}
]]>
    </src>


    <src name="KpiExtractorSPI" type="java" title="KpiExtractorSPI">
<![CDATA[
public interface KpiExtractorSPI {


    default boolean accept(final RequestData request){
        return true;
    }

    default List<GenericMonitoringModelDTO> extractFromRequest(final KpiExtractorContext context){
        return List.of();
    }
    default List<GenericMonitoringModelDTO> extractFromResponse(final KpiExtractorContext context){
        return List.of();
    }
}

]]>
    </src>

        <src name="KpiExtractorContext" type="java" title="KpiExtractorContext">
<![CDATA[
@ToString(onlyExplicitlyIncluded = true)
@Setter
@Getter
@Builder(toBuilder = true)
@AllArgsConstructor
@NoArgsConstructor
public class KpiExtractorContext {
    private RequestData   request;
    private ResponseData  response;
    private LocalDateTime now;
    private JsonNode      requestContent;
    private JsonNode      responseContent;
}
]]>
    </src>



        <src name="UserKpiExtractor" type="java" title="Custom KPI extractor">
<![CDATA[
@Slf4j
@Component
public class UserKpiExtractor implements KpiExtractorSPI {
    // =================================================================================================================
    // ACCEPT
    // =================================================================================================================
    @Override
    public boolean accept(final RequestData request) {
        return request.getUri().contains("/user") && HttpVerbs.POST.equals(request.getMethod());
    }

    // =================================================================================================================
    // ON BEGIN
    // =================================================================================================================

    @Override
    public List<GenericMonitoringModelDTO> extractFromRequest(final KpiExtractorContext context) {
        return List.of(GenericMonitoringModelDTO.builder()
                                                .service("demo")
                                                .subService("user_request")
                                                .value(1L)
                                                .build());
    }

    // =================================================================================================================
    // ON BEGIN
    // =================================================================================================================
    @Override
    public List<GenericMonitoringModelDTO> extractFromResponse(final KpiExtractorContext context) {
        return List.of(GenericMonitoringModelDTO.builder()
                                                .service("demo")
                                                .subService("user_response")
                                                .value(1L)
                                                .build());
    }
}

]]>
    </src>


    <src name="MdcService" type="java" title="MdcService">
<![CDATA[
@Getter
@Slf4j
public class MdcService implements MdcServiceSpi {

    private static final String X_B_3_TRACE_ID       = "X-B3-TraceId";
    public static final  String ISO_DATE             = "yyyy-MM-dd'T'HH:mm:ss.sss";
    public static final  String CALL_TYPE_REST       = "REST";
    public static final  String CALL_TYPE_JMS        = "JMS";
    public static final  String CALL_TYPE_RABBITMQ   = "RABBITMQ";
    private static final String DEFAULT_STRING_VALUE = "xxxx";
    private static final String SEP                  = ";";
    private static final String IN                   = "in";
    private static final String OUT                  = "out";
    private static final String SUCCESS              = "success";
    private static final String ERROR                = "error";
    public static final  String NULL                 = "null";

    private List<LoggerMdcMappingSPI> mdcMappers = SpiLoader.getInstance()
                                                            .loadSpiServicesByPriority(LoggerMdcMappingSPI.class);

    private static final MdcService INSTANCE = new MdcService();

    public static MdcService getInstance() {  }

    // =========================================================================
    // CONSTRUCTOR
    // =========================================================================
    public MdcService() { }
    public void onContextRefreshed(final Object event) { }
    public void initialize() {  }


    // =========================================================================
    // SET MDC
    // =========================================================================
    public MdcServiceSpi setMdc(final Map<String, Serializable> values) {  }
    public MdcServiceSpi setMdc(final MDCKeys key, final Serializable value) {  }
    public MdcServiceSpi setMdc(final String key, final Serializable value) { }
    public MdcServiceSpi addMdc(final Tuple<String, Serializable>... keys) { }
    public MdcServiceSpi addMdc(final Collection<Tuple<String, Serializable>> keys) {  }

    // =========================================================================
    // GET MDC
    // =========================================================================
    public String getMdc(final MDCKeys key) { }
    public String getMdc(final String key) {  }

    public boolean getBoolean(final MDCKeys key) {  }
    public boolean getBoolean(final String key) {  }

    public int getInt(final MDCKeys key) {  }
    public int getInt(final String key) {  }

    public long getLong(final MDCKeys key) {  }
    public long getLong(final String key) {  }

    public double getDouble(final MDCKeys key) { }
    public double getDouble(final String key) { }

    public Charset getCharset(final MDCKeys key) {  }
    public Charset getCharset(final String key) { }


    public LocalDateTime getLocalDateTime(final MDCKeys key) { }
    public LocalDateTime getLocalDateTime(final String key) { }

    public Map<String, String> getAllMdc() { }
    public Map<String, Serializable> getAllMdcExtended() {  }


    // =========================================================================
    // REMOVE
    // =========================================================================
    public MdcServiceSpi remove(final MDCKeys... keys) { }
    public MdcServiceSpi remove(final String... keys) {  }
    public MdcService clear() { }


    // =========================================================================
    // FIELDS
    // =========================================================================
    public MdcServiceSpi deviceIdentifier(final String value) { }
    public String        deviceIdentifier() { }
    public MdcServiceSpi conversationId(final String value) {  }
    public String        conversationId() {  }
    public MdcServiceSpi correlationId(final String value) { }
    public String        correlationId() { } 
    public MdcServiceSpi traceId(final String value)  { } 
    public String        traceId()  { } 
    public MdcServiceSpi sessionId(final String value)  { } 
    public String        sessionId()  { } 
    public MdcServiceSpi processId(final String value) { } 
    public String        processId()  { } 
    public MdcServiceSpi requestId(final String value)  { } 
    public String        requestId()  { } 


    public MdcServiceSpi appClass(final String value) { }
    public String appClass() { }

    public MdcServiceSpi appClassShortName(final String value) { }
    public String appClassShortName() {  }

    public MdcServiceSpi domain(final String value) {  }
    public String domain() {  }

    public MdcServiceSpi subDomain(final String value) { }
    public String subDomain() {  }

    public MdcServiceSpi appMethod(final String value) { }
    public String appMethod() { }

    public MdcServiceSpi appService(final String value) { }
    public String appService() { }

    public MdcServiceSpi appSubService(final String value) {  }
    public String appSubService() {  }

    public MdcServiceSpi applicationVersion(final String value) {  }
    public String applicationVersion() {  }

    public MdcServiceSpi asset(final String value) { }
    public String asset() {  }

    public MdcServiceSpi authProtocol(final String value) {  }
    public String authProtocol() {  }

    public MdcServiceSpi callFrom(final String value) {  }
    public String callFrom() {  }

    public MdcServiceSpi callType(final String value) { }
    public String callType() { }

    public MdcServiceSpi country(final String value) { }
    public String country(){ }

    public MdcServiceSpi customerId(final String value) { }
    public String customerId() { }

    public MdcServiceSpi deviceIp(final String value) { }
    public String deviceIp() { }
    public MdcServiceSpi deviceClass(final String value) { }
    public String deviceClass() { }
    public MdcServiceSpi deviceNetworkSpeedDown(final double value) { }
    public double        deviceNetworkSpeedDown() { }
    public MdcServiceSpi deviceNetworkSpeedLatency(final double value) { }
    public double        deviceNetworkSpeedLatency() { }
    public MdcServiceSpi deviceNetworkSpeedUp(final double value) { }
    public double        deviceNetworkSpeedUp() { }
    public MdcServiceSpi deviceNetworkType(final String value) { }
    public String        deviceNetworkType(){ }
    public MdcServiceSpi deviceType(final String value){ }
    public String        deviceType() { }

    public MdcServiceSpi duration(final long value) { }
    public long duration(){ }

    public MdcServiceSpi env(final String value) { }
    public String env(){ }

    public MdcServiceSpi errorCategory(final String value) { }
    public String        errorCategory(){ }
    public MdcServiceSpi errorCode(final String value){ }
    public boolean       hasError() { }
    public MdcServiceSpi errorCode(final ErrorCode errorCode) { }
    public MdcServiceSpi errorCodeRemove() { }
    public ErrorCode     errorCode() { }
    public MdcServiceSpi errorExploitationError(final boolean value) { }
    public boolean       errorExploitationError() { }
    public MdcServiceSpi errorField(final String... value) { }
    public String        errorField() { }
    public MdcServiceSpi errorMessage(final String value) { }
    public String        errorMessage() { }
    public MdcServiceSpi errorMessageDetail(final String value) { }
    public String        errorMessageDetail() { }
    public MdcServiceSpi errorRetryable(final boolean value) { }
    public boolean       errorRetryable() { }
    public MdcServiceSpi errorRollback(final boolean value) { }
    public boolean       errorRollback(){ }
    public MdcServiceSpi errorStatus(final int value) { } 
    public int           errorStatus() { } 
    public MdcServiceSpi errorType(final String value) { } 
    public String        errorType() { } 
    public MdcServiceSpi errorUrl(final String value)  { } 
    public String        errorUrl()  { } 
    public MdcServiceSpi exceptionName(final String value)  { } 
    public MdcServiceSpi errorDomain(final String value) { } 
    public String        errorDomain()  { } 
    public MdcServiceSpi errorSubDomain(final String value)  { } 
    public String        errorSubDomain() { } 
    public String        exceptionName() { } 

    public MdcServiceSpi flags(final String value)  { } 
    public String flags() { } 

    public MdcServiceSpi from(final LocalDateTime value) { } 
    public LocalDateTime from() { } 

    public MdcServiceSpi groupId(final String value)  { } 
    public String        groupId()  { } 
    public MdcServiceSpi artifactId(final String value) { } 
    public String        artifactId()  { } 
    public MdcServiceSpi version(final String value)  { } 
    public String        version()  { } 

    public MdcServiceSpi commitId(final String value)  { } 
    public String        commitId()  { } 
    public MdcServiceSpi commitDate(final String value) { } 
    public String        commitDate() { } 

    public MdcServiceSpi fromTimestamp(final long value)  { } 
    public long fromTimestamp() { } 

    public MdcServiceSpi functionalUid(final String value) { } 
    public String functionalUid()  { } 

    public MdcServiceSpi globalStatus(final String value) { } 
    public String globalStatus()  { } 
    public void globalStatusSuccess()  { } 

    public void globalStatusError()  { } 
    public MdcServiceSpi removeGlobalStatus()  { } 

    public MdcServiceSpi healthStatus(final String value)  { } 
    public String healthStatus()  { } 

    public MdcServiceSpi hostname(final String value)  { } 
    public String hostname()  { } 

    public MdcServiceSpi httpStatus(final int value)  { } 
    public int httpStatus()  { } 

    public MdcServiceSpi instanceName(final String value) { } 
    public String instanceName()  { } 

    public MdcServiceSpi instanceNumber(final String value)  { } 
    public String instanceNumber()  { } 

    public MdcServiceSpi ioinfoIoLog(final IoInfoDTO info) { } 
    public MdcServiceSpi removeIoinfoIoLog() { } 
    public MdcServiceSpi ioinfoPartner(final IoInfoDTO info)  { } 

    public MdcServiceSpi partnerRemove()  { } 
    public MdcServiceSpi removeIoinfoPartner() { } 

    public MdcServiceSpi language(final String value)  { } 
    public String language()  { } 

    public MdcServiceSpi lifecycle(final String value) { } 
    public String        lifecycle()  { } 
    public MdcServiceSpi lifecycleIn()  { } 
    public Exception     lifecycleIn(final VoidFunctionWithException function)  { } 
    public MdcServiceSpi lifecycleOut()  { } 
    public Exception     lifecycleOut(final VoidFunctionWithException function)  { } 
    public MdcServiceSpi lifecycleRemove()  { } 

    public MdcServiceSpi majorVersion(final String value)  { } 
    public String majorVersion()  { } 

    public MdcServiceSpi messageId(final String value)  { } 
    public String messageId()  { } 

    public MdcServiceSpi methodInCause(final String value)  { } 
    public String methodInCause() { } 

    public Map<String, String> getTrackingInformation()  { } 
    public Map<String, String> getTrackingInformation(final Headers headers) { } 

    public MdcServiceSpi orderId(final String value)  { } 
    public String orderId()  { } 

    public MdcServiceSpi osVersion(final String value)  { } 
    public String osVersion()  { } 

    public MdcServiceSpi parentSpanId(final String value) { } 
    public String parentSpanId() { } 

    public MdcServiceSpi partner(final String value)  { } 
    public String partner()  { } 

    public MdcServiceSpi partnerRequestCharset(final String value) { } 
    public MdcServiceSpi partnerRequestCharset(final Charset value)  { } 

    public Charset partnerRequestCharset()  { } 
    public MdcServiceSpi partnerResponseCharset(final String value) { } 

    public MdcServiceSpi partnerResponseCharset(final Charset value)  { } 
    public Charset partnerResponseCharset()  { } 

    public MdcServiceSpi partnerResponseDuration(final long value)  { } 
    public long partnerResponseDuration() { } 

    public MdcServiceSpi partnerResponseMessage(final String value)  { } 
    public String partnerResponseMessage()  { } 

    public MdcServiceSpi partnerResponseStatus(final int value) { } 
    public int partnerResponseStatus()  { } 

    public MdcServiceSpi partnerService(final String value)  { } 
    public String partnerService()  { } 

    public MdcServiceSpi partnerSubService(final String value)  { } 
    public String partnerSubService() { } 

    public MdcServiceSpi partnerType(final String value) { } 
    public String partnerType()  { } 

    public MdcServiceSpi partnerUrl(final String value)  { } 
    public String partnerUrl()  { } 

    public MdcServiceSpi partnerVerb(final String value) { } 
    public String partnerVerb()  { } 

    public MdcServiceSpi price(final double value)  { } 
    public double price()  { } 

    public MdcServiceSpi principal(final String value)  { } 
    public String principal()  { } 

    public MdcServiceSpi productId(final String value)  { } 
    public String productId()  { } 
    
    public MdcServiceSpi processName(final String value) { } 
    public String processName()  { } 

    public MdcServiceSpi processStatus(final String value)  { } 
    public String processStatus()  { } 

    public MdcServiceSpi quantity(final double value)  { } 
    public double quantity()  { } 

    public MdcServiceSpi remoteAddress(final String value)  { } 
    public String remoteAddress()  { } 

    public MdcServiceSpi requestHeaders(final String value) { } 
    public String requestHeaders()  { } 

    public MdcServiceSpi reservationNumber(final String value)  { } 
    public String reservationNumber()  { } 

    public MdcServiceSpi responseHeaders(final String value) { } 
    public String responseHeaders()  { } 

    public MdcServiceSpi service(final String value) { } 
    public String service()  { } 

    public MdcServiceSpi size(final double value)  { } 
    public double size()  { } 

    public MdcServiceSpi until(final LocalDateTime value)  { } 
    public LocalDateTime until()  { } 

    public MdcServiceSpi untilTimestamp(final long value)  { } 
    public long untilTimestamp()  { } 

    public MdcServiceSpi uri(final String value)  { } 
    public String uri()  { } 

    public MdcServiceSpi url(final String value)  { } 
    public String url()  { } 

    public MdcServiceSpi urlPattern(final String value)  { } 
    public String urlPattern()  { } 

    public MdcServiceSpi urlPatternVerb(final String value)  { } 
    public String urlPatternVerb()  { } 

    public MdcServiceSpi userAgent(final String value)  { } 
    public String userAgent()  { } 

    public MdcServiceSpi userId(final String value)  { } 
    public String userId()  { } 

    public MdcServiceSpi verb(final String value)  { } 
    public String verb()  { } 

    public MdcServiceSpi status(final int status)  { } 
    public int status()  { }    

    public MdcServiceSpi warning(final String value)  { } 
    public String warning()  { } 
}

]]>
    </src>


        <src name="mdcServiceUsage" type="java" title="Usage of MdcService">
<![CDATA[
public List<ProductOrder> pay(Collection<ProductOrder> products){
    MdcService.getInstance()
              .quantity(products.size())
              .price(products.stream()
                             .mapToDouble(ProductOrder::getPrice)
                             .sum());
}
]]>
    </src>

        <src name="LoggerMdcMappingSPI" type="java" title="LoggerMdcMappingSPI">
<![CDATA[
public interface LoggerMdcMappingSPI {
    boolean accept(final String key);

    Serializable convert(final String value);
}
]]>
    </src>


     <src name="MdcInitializerSpi" type="java" title="MdcInitializerSpi">
<![CDATA[
@FunctionalInterface
public interface MdcInitializerSpi {
    String  DEFAULT_STRING  = "xxxx";
    long    DEFAULT_LONG    = 0L;
    double  DEFAULT_DOUBLE  = 0.0;
    boolean DEFAULT_BOOLEAN = false;

    Map<String, Serializable> getDefaultValue();

    default Map.Entry<String, Serializable> buildEntry(final MDCKeys key, Serializable value) {}
    default Map.Entry<String, Serializable> buildEntry(final String key, Serializable value) { }
}
]]>
    </src>

         <src name="MdcDynamicFieldSPI" type="java" title="MdcDynamicFieldSPI">
<![CDATA[
public interface MdcDynamicFieldSPI {
    Map<String, Serializable> generate();
}
]]>
    </src>
    <src name="exclud_url_interception" type="yaml" title="Exclud interception by properties">
<![CDATA[
inugami:
    monitoring:
        interceptor:
            url:
                skip: .*api-docs.*;.*swagger-ui.*
]]>
    </src>

        <src name="MyTechnicalFilter" type="java" title="Exclud interception by SPI">
<![CDATA[
@Component
public class MyTechnicalFilter implements Interceptable {

    @Override
    public boolean isInterceptable(final RequestData request) {
        // Example: Do not intercept if a specific header is present
        String bypassHeader = request.getHeaders().get("X-Inugami-Skip");
        return !"true".equalsIgnoreCase(bypassHeader);
    }
}
]]>
    </src>
</xml>
